<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/gameserver_writeup/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="GamingServer_writeup" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/gameserver_writeup/" /><meta property="article:published_time" content="2020-10-10T22:07:40-04:00" />



<meta name="twitter:title" content="GamingServer_writeup"/>
<meta name="twitter:description" content="Can you gain access to this gaming server built by amateurs with no experience of web development and take advantage of the deployment system?"/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/gameserver_writeup'>gameserver_writeup</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://tzero86bits.tk/photos/" typeof="ListItem">photos/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>GamingServer_writeup</h1>
Oct. 10, 2020


<br/><br/>
<img src="../img/gamingServer_cover.gif" alt="Post Cover Gif animation";>
<br/><br/>
<h2 id="gamingserver---thm-room">GamingServer - THM Room</h2>
<p>Welcome back! Today I have another writeup. This time I went for a just-released room on TryHackMe called <code>Gaming Server</code>. I hope you enjoy it!</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/gamingserver">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords, flag values, or any kind of answers to the room questions were intentionally masked as required by THM writeups rules.</li>
</ul>
<h3 id="recon">Recon</h3>
<p>I started a scan with <code>Autorecon</code> and while that is running let&rsquo;s look into what&rsquo;s at port <code>80</code>.</p>
<blockquote>
<p><code>sudo autorecon 10.10.85.253</code></p>
</blockquote>
<p>If we browse to the IP address, we can see we do have a webpage being served about some game:</p>
<p><img src="https://i.imgur.com/QOJf7kD.png" alt=""></p>
<p>And If we  open the console we see right away there is a mention to a possible username of <code>john</code>.</p>
<p>Let&rsquo;s see if we can find something else on that page. Autorecon is already running <code>gobuster</code> for us, so we should be able to look into those results in a bit.</p>
<p>If we look into <code>/about.php</code> again the console shows a commented piece of code for file uploads.
Let&rsquo;s see if we can upload a <code>phpbash</code>. You can download a copy from <a href="https://github.com/Arrexel/phpbash/blob/master/phpbash.php">here</a>.</p>
<p>Uploading the <code>phpbash</code> file did not work, there was no error either. But when looking at <code>/uploads</code> the file wasn&rsquo;t there. It&rsquo;s very possible this is just a decoy. Let&rsquo;s keep looking.</p>
<p>There are some other interesting files: A hacker manifesto, a meme and a dictionary.</p>
<p><img src="https://i.imgur.com/wp85FL4.png" alt=""></p>
<p>The mem is just an image of Beaker, who according to the internet is:</p>
<blockquote>
<p>Beaker is the hapless assistant to Dr. Bunsen Honeydew from The Muppets.</p>
</blockquote>
<p>Gobuster found another interesting directory: <code>/secret</code></p>
<p><img src="https://i.imgur.com/lZ2z39X.png" alt=""></p>
<p>The secret key is an RSA Private one.
Let&rsquo;s see if we can ssh login as <code>John</code> using that key. To do that, we still need to crack the passphrase of the RSA key.</p>
<p>We need to use <code>ssh2john</code> so we can try to crack it with <code>john</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/gamingServer<span style="color:#f92672">]</span>
└─$ python /usr/share/john/ssh2john.py secretKey &gt; id_rsa.hash

</code></pre></div><p>Once that&rsquo;s done let&rsquo;s run john using the dictionary we found on the site as follows:</p>
<pre><code>john --wordlist=dict.lst id_rsa.hash
</code></pre><p>That' works and we get the passphrase:</p>
<p><img src="https://i.imgur.com/N7TVFqN.png" alt=""></p>
<p>Now we can try to ssh login as <code>john</code>:</p>
<p><img src="https://i.imgur.com/rCHqiZp.png" alt=""></p>
<p>It works, we are in! yep! Let' me have this hacking cliche, just this time. :joy:</p>
<p>Once there we just do <code>cat user.txt</code> and we get the first flag.</p>
<h3 id="getting-root">Getting root</h3>
<p>Now let&rsquo;s see how we get root. First I fire up a simple http server with python to upload <code>linpeas.sh</code> to the target machine. And then run linpeas.</p>
<p><img src="https://i.imgur.com/8TRAJcD.png" alt=""></p>
<blockquote>
<p>Remember to <code>chmod +x linpeas.sh</code> before trying to run it.</p>
</blockquote>
<p>Linpeas results don&rsquo;t show anything that I know how to exploit, but while checking <code>id</code> command for the logged user something interesting comes up:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">john@exploitable:/tmp$ id
uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>john<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>john<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>john<span style="color:#f92672">)</span>,4<span style="color:#f92672">(</span>adm<span style="color:#f92672">)</span>,24<span style="color:#f92672">(</span>cdrom<span style="color:#f92672">)</span>,27<span style="color:#f92672">(</span>sudo<span style="color:#f92672">)</span>,30<span style="color:#f92672">(</span>dip<span style="color:#f92672">)</span>,46<span style="color:#f92672">(</span>plugdev<span style="color:#f92672">)</span>,108<span style="color:#f92672">(</span>lxd<span style="color:#f92672">)</span>

</code></pre></div><p>It seems John is part of the <code>ldx</code> group. And if I remember correctly I read something about getting root if you are part of that group. I think it was on <code>hacktricks</code>. Let&rsquo;s check <a href="https://book.hacktricks.xyz/linux-unix/privilege-escalation/interesting-groups-linux-pe/lxd-privilege-escalation">that</a> out.</p>
<blockquote>
<p>Also check out this post about LXD which puts a nice context on this vulnerability. Follow <a href="https://reboare.github.io/lxd/lxd-escape.html">this Link</a> to read it.</p>
</blockquote>
<p>I tried the <code>With Internet</code> method first, by that didn&rsquo;t work. So let&rsquo;s try the <code>Method 2</code> and see if we get lucky this time:</p>
<p>We first need to create ourselves an image of Alpine, using the <code>lxd-alpine-builder</code> script located <a href="https://github.com/saghul/lxd-alpine-builder">here</a>.</p>
<p>We just need to run the builder script as sudo and it&rsquo;ll start making the image for us:</p>
<p><img src="https://i.imgur.com/q9m8LRM.png" alt=""></p>
<p>Once done you&rsquo;ll see a compressed file on the directory where you built the image:</p>
<p><img src="https://i.imgur.com/6s79Ctf.png" alt=""></p>
<p>now we need to upload the image to the target machine.</p>
<p><img src="https://i.imgur.com/UFS2ZFC.png" alt=""></p>
<p>Now we need to let LDX know we have an image, import that image, add a device to it that mounts the file system with privileges and gives us root when we execute it:</p>
<p><img src="https://i.imgur.com/LFhL5bO.png" alt=""></p>
<p>And since we mounted our files at <code>/mnt/root</code> we head that way to get the root flag:</p>
<p><img src="https://i.imgur.com/D3YsaYS.png" alt=""></p>
<p>That&rsquo;s it for this room, quite an interesting one. First time for me doing anything related with <code>LXD</code> and Alpine. It was a good lesson and I really enjoyed it.</p>
<p>Hope you find this useful!</p>
<p>Happy hacking and thanks for stopping by!</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>



        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
